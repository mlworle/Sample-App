<!DOCTYPE html>
<html id="custDomain"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/1310fd97f1" type="text/javascript"></script><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/nr-768.js"></script><script type="text/javascript" async="" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/6713.js"></script><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/54eea5d20a23b37d87000040.js" async="" type="text/javascript"></script><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/sdk.js" id="facebook-jssdk"></script><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/widgets.js" id="twitter-wjs"></script><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/analytics.js" async=""></script><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/1197428788.js" type="text/javascript"></script>

<meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="4i3ly1BJWsQpVgekZOd6L3VaTT1fMy+B/Agep3sP/xOQbIL6Umgd0CXH4/8EhUDQ85Yj/HUe00Gz4m0nR1YfLQ==">
<meta charset="UTF-8">
<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"beacon":"bam.nr-data.net","errorBeacon":"bam.nr-data.net","licenseKey":"1310fd97f1","applicationID":"4014257","transactionName":"IVZWR0tbWF4BFxhWVw1SSxxaQUdGCwhoRl0DXQ==","queueTime":0,"applicationTime":141,"agent":"js-agent.newrelic.com/nr-768.min.js"}</script>
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({QJf3ax:[function(e,n){function t(e){function n(n,t,a){e&&e(n,t,a),a||(a={});for(var u=c(n),f=u.length,s=i(a,o,r),p=0;f>p;p++)u[p].apply(s,t);return s}function a(e,n){f[e]=c(e).concat(n)}function c(e){return f[e]||[]}function u(){return t(n)}var f={};return{on:a,emit:n,create:u,listeners:c,_events:f}}function r(){return{}}var o="nr@context",i=e("gos");n.exports=t()},{gos:"7eSDFh"}],ee:[function(e,n){n.exports=e("QJf3ax")},{}],3:[function(e,n){function t(e){return function(){r(e,[(new Date).getTime()].concat(i(arguments)))}}var r=e("handle"),o=e(1),i=e(2);"undefined"==typeof window.newrelic&&(newrelic=window.NREUM);var a=["setPageViewName","addPageAction","setCustomAttribute","finished","addToTrace","inlineHit","noticeError"];o(a,function(e,n){window.NREUM[n]=t("api-"+n)}),n.exports=window.NREUM},{1:12,2:13,handle:"D5DuLP"}],gos:[function(e,n){n.exports=e("7eSDFh")},{}],"7eSDFh":[function(e,n){function t(e,n,t){if(r.call(e,n))return e[n];var o=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:o,writable:!0,enumerable:!1}),o}catch(i){}return e[n]=o,o}var r=Object.prototype.hasOwnProperty;n.exports=t},{}],D5DuLP:[function(e,n){function t(e,n,t){return r.listeners(e).length?r.emit(e,n,t):void(r.q&&(r.q[e]||(r.q[e]=[]),r.q[e].push(n)))}var r=e("ee").create();n.exports=t,t.ee=r,r.q={}},{ee:"QJf3ax"}],handle:[function(e,n){n.exports=e("D5DuLP")},{}],XL7HBI:[function(e,n){function t(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:i(e,o,function(){return r++})}var r=1,o="nr@id",i=e("gos");n.exports=t},{gos:"7eSDFh"}],id:[function(e,n){n.exports=e("XL7HBI")},{}],G9z0Bl:[function(e,n){function t(){var e=d.info=NREUM.info,n=f.getElementsByTagName("script")[0];if(e&&e.licenseKey&&e.applicationID&&n){c(p,function(n,t){n in e||(e[n]=t)});var t="https"===s.split(":")[0]||e.sslForHttp;d.proto=t?"https://":"http://",a("mark",["onload",i()]);var r=f.createElement("script");r.src=d.proto+e.agent,n.parentNode.insertBefore(r,n)}}function r(){"complete"===f.readyState&&o()}function o(){a("mark",["domContent",i()])}function i(){return(new Date).getTime()}var a=e("handle"),c=e(1),u=window,f=u.document;e(2);var s=(""+location).split("?")[0],p={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-768.min.js"},d=n.exports={offset:i(),origin:s,features:{}};f.addEventListener?(f.addEventListener("DOMContentLoaded",o,!1),u.addEventListener("load",t,!1)):(f.attachEvent("onreadystatechange",r),u.attachEvent("onload",t)),a("mark",["firstbyte",i()])},{1:12,2:3,handle:"D5DuLP"}],loader:[function(e,n){n.exports=e("G9z0Bl")},{}],12:[function(e,n){function t(e,n){var t=[],o="",i=0;for(o in e)r.call(e,o)&&(t[i]=n(o,e[o]),i+=1);return t}var r=Object.prototype.hasOwnProperty;n.exports=t},{}],13:[function(e,n){function t(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(0>o?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=t},{}]},{},["G9z0Bl"]);</script>
<title>Chapter 6: Modeling users
 | Ruby on Rails Tutorial (3rd Ed.) | Softcover.io</title>
<link href="https://www.railstutorial.org/apple-touch-icon-precomposed.png" rel="apple-touch-icon-precomposed">
<script>
  window.Config = {
    bucket: "softcover",
    previewBucket: "softcover-cloud"
  }
</script>
<link href="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/font-awesome.css" rel="stylesheet">
<link href="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/css.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" media="screen" href="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/reading-79463325b9b7a751f625b858882a30d3bf5aa476587a01e11d8b.css">
<link href="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/print-f4bd271fd41b8086410e78c14546336605a29e5c72c2d08b094c7c.css" media="print" rel="stylesheet" type="text/css">
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/jquery-2.js" type="text/javascript"></script>
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/jquery.js" type="text/javascript"></script>
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/underscore-min.js" type="text/javascript"></script>
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/a" type="text/javascript"></script>
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/jsapi" type="text/javascript"></script>
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/application-286155d776e5d2b7caa0bc3bf9b869d75ca292cd83810e6d3.js"></script>
<meta content="http://www.railstutorial.org" property="og:url">
<meta content="Ruby on Rails Tutorial (3rd Ed.)" property="og:title">
<meta content="The Ruby on Rails Tutorial book and screencast series teach you how to develop and deploy real, industrial-strength web applications with Ruby on Rails, the open-source web framework that powers top websites such as Twitter, Hulu, GitHub, and the Yellow Pages. The Ruby on Rails Tutorial book is available for free online and is available for purchase as an ebook (PDF, EPUB, and MOBI formats). The companion screencast series includes 12 individual lessons, one for each chapter of the Ruby on Rails Tutorial book. All purchases also include a free copy of the Solutions Manual for Exercises, with solutions to every exercise in the book." property="og:description">
<meta content="Softcover.io" property="og:site_name">
<meta content="https://softcover.s3.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/images/cover-web.png" property="og:image">
<meta content="https://softcover.s3.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/images/cover-web.png" property="og:image:secure_url">
<meta content="image/png" property="og:image:type">
<meta content="500" property="og:image:width">
<meta content="500" property="og:image:height">
<script>
  // test key only
  // this identifies your website in the createToken call below
  Stripe.setPublishableKey('pk_live_Xn1p0BfxqKxkAxtEr03P7wmd');
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('require', 'linker');
  ga('linker:autoLink', ['www.railstutorial.org', 'softcover.io']);

  ga('create', 'UA-46858978-1', 'softcover.io', {'allowLinker': true});
  ga('send', 'pageview');

  ga('create', 'UA-8667566-1', 'auto', {
    'name': 'book',
    'allowLinker': true
  });

  ga('book.send', 'pageview');

</script>

<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>


<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/custom_domain_js.js" type="text/javascript"></script>
<script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/tagjs" async="" type="text/javascript"></script><img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/a.gif" border="0" height="1" width="1"><img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/seg_003.gif" border="0" height="1" width="1"><img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/seg_002.gif" border="0" height="1" width="1"><img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/seg.gif" border="0" height="1" width="1"><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Hover_Arrow {position: absolute; width: 15px; height: 11px; cursor: pointer}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_Menu_Close {position: absolute; width: 31px; height: 31px; top: -15px; left: -15px}
</style><style type="text/css">.MathJax_Preview .MJXc-math {color: inherit!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXc-script {font-size: .8em}
.MJXc-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXc-bold {font-weight: bold}
.MJXc-italic {font-style: italic}
.MJXc-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-largeop {font-size: 150%}
.MJXc-largeop.MJXc-int {vertical-align: -.2em}
.MJXc-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXc-display {display: block; text-align: center; margin: 1em 0}
.MJXc-math span {display: inline-block}
.MJXc-box {display: block!important; text-align: center}
.MJXc-box:after {content: " "}
.MJXc-rule {display: block!important; margin-top: .1em}
.MJXc-char {display: block!important}
.MJXc-mo {margin: 0 .15em}
.MJXc-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXc-denom {display: inline-table!important; width: 100%}
.MJXc-denom > * {display: table-row!important}
.MJXc-surd {vertical-align: top}
.MJXc-surd > * {display: block!important}
.MJXc-script-box > *  {display: table!important; height: 50%}
.MJXc-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXc-script-box > *:last-child > * {vertical-align: bottom}
.MJXc-script-box > * > * > * {display: block!important}
.MJXc-mphantom {visibility: hidden}
.MJXc-munderover {display: inline-table!important}
.MJXc-over {display: inline-block!important; text-align: center}
.MJXc-over > * {display: block!important}
.MJXc-munderover > * {display: table-row!important}
.MJXc-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXc-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXc-mtr {display: table-row!important}
.MJXc-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXc-mtr > .MJXc-mtd:first-child {padding-left: 0}
.MJXc-mtr:first-child > .MJXc-mtd {padding-top: 0}
.MJXc-mlabeledtr {display: table-row!important}
.MJXc-mlabeledtr > .MJXc-mtd:first-child {padding-left: 0}
.MJXc-mlabeledtr:first-child > .MJXc-mtd {padding-top: 0}
.MJXc-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXc-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXc-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXc-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXc-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXc-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXc-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXc-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXc-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXc-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXc-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_CHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow-x:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_close_icon:active{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}.fb_dialog_loader{background-color:#f6f7f8;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3a5795;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #2f477a;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f8;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(https://static.xx.fbcdn.net/rsrc.php/v2/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(https://static.xx.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}</style><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/MathJax.js" type="text/javascript" id="mathJaxJS"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Hover_Arrow {position: absolute; width: 15px; height: 11px; cursor: pointer}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; color: #666666}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_Menu_Close {position: absolute; width: 31px; height: 31px; top: -15px; left: -15px}
</style><style type="text/css">.MathJax_Preview .MJXc-math {color: inherit!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1px; bottom: 2px; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXc-script {font-size: .8em}
.MJXc-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXc-bold {font-weight: bold}
.MJXc-italic {font-style: italic}
.MJXc-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXc-largeop {font-size: 150%}
.MJXc-largeop.MJXc-int {vertical-align: -.2em}
.MJXc-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXc-display {display: block; text-align: center; margin: 1em 0}
.MJXc-math span {display: inline-block}
.MJXc-box {display: block!important; text-align: center}
.MJXc-box:after {content: " "}
.MJXc-rule {display: block!important; margin-top: .1em}
.MJXc-char {display: block!important}
.MJXc-mo {margin: 0 .15em}
.MJXc-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXc-denom {display: inline-table!important; width: 100%}
.MJXc-denom > * {display: table-row!important}
.MJXc-surd {vertical-align: top}
.MJXc-surd > * {display: block!important}
.MJXc-script-box > *  {display: table!important; height: 50%}
.MJXc-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXc-script-box > *:last-child > * {vertical-align: bottom}
.MJXc-script-box > * > * > * {display: block!important}
.MJXc-mphantom {visibility: hidden}
.MJXc-munderover {display: inline-table!important}
.MJXc-over {display: inline-block!important; text-align: center}
.MJXc-over > * {display: block!important}
.MJXc-munderover > * {display: table-row!important}
.MJXc-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXc-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXc-mtr {display: table-row!important}
.MJXc-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXc-mtr > .MJXc-mtd:first-child {padding-left: 0}
.MJXc-mtr:first-child > .MJXc-mtd {padding-top: 0}
.MJXc-mlabeledtr {display: table-row!important}
.MJXc-mlabeledtr > .MJXc-mtd:first-child {padding-left: 0}
.MJXc-mlabeledtr:first-child > .MJXc-mtd {padding-top: 0}
.MJXc-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXc-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXc-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXc-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXc-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXc-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXc-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXc-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXc-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXc-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXc-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_CHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body class=""><div style="display: none;" id="MathJax_Message"></div><div style="display: none;" id="MathJax_Message"></div>
<noscript>
<div id='noscript'>
<h2>Please enable javascript</h2>
This site requires you to allow Javascript to run in the browser for all features to work. Thank you!
</div>
</noscript>
<script type="text/javascript">
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
window.fbAsyncInit = function() {
FB.init({
appId      : '145973438749643',
xfbml      : true,
version    : 'v2.0'
});
};
(function(d, s, id){
var js, fjs = d.getElementsByTagName(s)[0];
if (d.getElementById(id)) {return;}
js = d.createElement(s); js.id = id;
js.src = "//connect.facebook.net/en_US/sdk.js";
fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>
<div class="closeLeft container">
<div class="container_footer">
<div id="header">
<div class="wrapper">
<a class="logo" href="https://www.softcover.io/"><img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/logo-ac6f1f6a838105d63e98f5fd5f2cf2596824a92c61a7f3c2a7aaf88.png" alt="Logo ac6f1f6a838105d63e98f5fd5f2cf2596824a92c61a7f3c2a7aaf884a61e2fc1">
</a><a id="mobileMenu" href="javascript://"><div class="closedMenu">
≡
<span>Menu</span>
</div>
<div class="openMenu">
x
<span>Close</span>
</div>
</a><div class="j_userHeader closeLeft" style="display:inline"><ul class="headerMenu">
<li><a href="https://www.softcover.io/login">Log In</a></li>
<li><a href="https://www.softcover.io/account/sign_up">Sign Up</a></li>
</ul>
</div>
<div style="display: none;" id="dropBG"></div>
<div class="clear"></div>
</div>
</div>

<link rel="stylesheet" media="screen" href="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/custom.css">
<div id="pageBook">
<div id="bookHeader">
<div class="wrapper">
<div class="bookCover">
<a href="https://www.railstutorial.org/book"><img class="cover" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/cover-web.png" alt="Cover web">
<img class="coverBG" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/cover_bg-e5e0c77fac617f88e7a2088ebb8aac68ac4f978d6ce9e66a77a.png" alt="Cover bg e5e0c77fac617f88e7a2088ebb8aac68ac4f978d6ce9e66a77a34d255dbfea02">
<p>
<i class="ibooksMedia iRead"></i>
READ ONLINE FREE
</p>
</a></div>
<div class="bookInfo">
<h1>
Ruby on Rails Tutorial (3rd Ed.)
<span class="j_subtitle">Learn Web Development with Rails</span>
<strong>Michael Hartl</strong>
</h1>
<p class="j_description">
 The Ruby on Rails Tutorial book and screencast series teach you how to 
develop and deploy real, industrial-strength web applications with Ruby 
on Rails, the open-source web framework that powers top websites such as
 Twitter, Hulu, GitHub, and the Yellow Pages. The Ruby on Rails Tutorial
 book is available for free online and is available for purchase as an 
ebook (PDF, EPUB, and MOBI formats). The companion screencast series 
includes 12 individual lessons, one for each chapter of the Ruby on 
Rails Tutorial book. All purchases also include a free copy of the 
Solutions Manual for Exercises, with solutions to every exercise in the 
book. 

</p>

<div class="bookControls">
<a href="https://www.railstutorial.org/"><button class="transBG">Book Info</button>
</a><a href="mailto:admin@railstutorial.org"><button class="transBG">Contact Author</button>
</a></div>

</div>

</div>
</div>

<div class="bookMenuFixed" id="bookMenu">
<div class="wrapper">
<div class="bookMenuControls" style="display:">
<div class="bookMenuArows">
<a class="leftArrow" href="javascript://">◄</a>
<a class="upArrow" href="javascript://">▲</a>
<a class="rightArrow" href="javascript://">►</a>
</div>
<div class="bookMenuSize">
<a id="sizeRegular" class="current" href="javascript://"></a>
<a id="sizeBig" href="javascript://"></a>
<a id="sizeBigger" href="javascript://"></a>
</div>
<div class="bookMenuSearch">
<a id="j_singlePage" href="javascript://"><i class="fa fa-search"></i>
Single Page
</a></div>
</div>
<div class="dropDown" id="j_chapterDropDown" style="display:">
<span id="chapterTitle">Chapter 6: Modeling users
</span>
<ul class="dropMenu"><li><a>Frontmatter
</a></li><li><a>Chapter 1: From zero to deploy
</a></li><li><a>Chapter 2: A toy app
</a></li><li><a>Chapter 3: Mostly static pages
</a></li><li><a>Chapter 4: Rails-flavored Ruby
</a></li><li><a>Chapter 5: Filling in the layout
</a></li><li><a>Chapter 6: Modeling users
</a></li><li><a>Chapter 7: Sign up
</a></li><li><a>Chapter 8: Log in, log out
</a></li><li><a>Chapter 9: Updating, showing, and deleting users
</a></li><li><a>Chapter 10: Account activation and password reset
</a></li><li><a>Chapter 11: User microposts
</a></li><li><a>Chapter 12: Following users
</a></li></ul>
</div>
<div class="bookMenuActions j_downloadLinks"><a onclick="$('#bookMenuEmail').toggleClass('open'); return false" href=""><button class="greyButton iEmailUpdate">
<i class="fa fa-heart"></i>
</button>
</a><a class="buttonStyle attention" href="https://www.railstutorial.org/#pricing">Buy Now</a>
<a href="https://www.softcover.io/email-capture/28fdb94f/ruby_on_rails_tutorial_3rd_edition"><button>Download Previews</button>
</a></div>
</div>
<div class="animated" id="bookMenuEmail">
<div class="wrapper">
<label>Follow this book to receive email updates from the author.</label>
<div class="j_followBookForm"><form action="https://www.softcover.io/books/107/follow" accept-charset="UTF-8" method="get"><input name="utf8" value="✓" type="hidden">
<!-- %input{name: "name", type: "text", placeholder: "YOUR NAME"} -->
<input name="email" placeholder="Your email address" type="text">
<input class="greyButton optClick_follow" value="Follow Author" type="submit">
</form>

</div>
</div>
</div>
</div>

<div class="wrapper" id="bookWr">
<div class="bookChapterTop">Chapter 6: Modeling users
</div>
<div style="opacity: 1;" id="bookHtml"><div id="book"><div data-chapter="modeling_users" data-number="6" class="chapter" data-tralics-id="cid37" id="_cha-modeling_users"><h1><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#cha-modeling_users"><span class="number">Chapter 6 </span>Modeling users</a></h1>
<p>In <a class="hyperref" href="https://www.railstutorial.org/book/filling_in_the_layout#cha-filling_in_the_layout">Chapter&nbsp;<span class="ref">5</span></a>, we ended with a stub page for creating new users (<a class="hyperref" href="https://www.railstutorial.org/book/filling_in_the_layout#sec-user_signup">Section&nbsp;<span class="ref">5.4</span></a>).<span class="intersentencespace"></span> Over the course of the next five chapters, we’ll fulfill the promise implicit in this incipient signup page.<span class="intersentencespace"></span> In this chapter, we’ll take the first critical step by creating a <em>data model</em> for users of our site, together with a way to store that data.<span class="intersentencespace"></span> In <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>, we’ll give users the ability to sign up for our site and create a user profile page.<span class="intersentencespace"></span> Once users can sign up, we’ll let them log in and log out as well (<a class="hyperref" href="https://www.railstutorial.org/book/log_in_log_out#cha-log_in_log_out">Chapter&nbsp;<span class="ref">8</span></a>), and in <a class="hyperref" href="https://www.railstutorial.org/book/updating_and_deleting_users#cha-updating_showing_and_deleting_users">Chapter&nbsp;<span class="ref">9</span></a> (<a class="hyperref" href="https://www.railstutorial.org/book/updating_and_deleting_users#sec-requiring_logged_in_users">Section&nbsp;<span class="ref">9.2.1</span></a>) we’ll learn how to protect pages from improper access.<span class="intersentencespace"></span> Finally, in <a class="hyperref" href="https://www.railstutorial.org/book/account_activation_password_reset#cha-account_activation_and_password_reset">Chapter&nbsp;<span class="ref">10</span></a> we’ll add account activation (thereby confirming a valid email address) and password resets.<span class="intersentencespace"></span> Taken together, the material in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#cha-modeling_users">Chapter&nbsp;<span class="ref">6</span></a> through <a class="hyperref" href="https://www.railstutorial.org/book/account_activation_password_reset#cha-account_activation_and_password_reset">Chapter&nbsp;<span class="ref">10</span></a> develops a full Rails login and authentication system.<span class="intersentencespace"></span> As you may know, there are various pre-built authentication solutions for Rails; <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#aside-roll_your_own">Box&nbsp;<span class="ref">6.1</span></a> explains why, at least at first, it’s probably a better idea to roll your own.</p>
<div data-number="6.1" data-tralics-id="uid507" id="_aside-roll_your_own" class="aside"><div class="heading"><span class="number">Box 6.1.</span> 

<span class="description">Roll your own authentication system</span></div>
<p>Virtually all web applications require a login and authentication system of some sort.<span class="intersentencespace"></span> As a result, most web frameworks have a plethora of options for implementing such systems, and Rails is no exception.<span class="intersentencespace"></span> Examples of authentication and authorization systems include <a target="_blank" href="http://github.com/thoughtbot/clearance">Clearance</a>, <a target="_blank" href="http://github.com/binarylogic/authlogic">Authlogic</a>, <a target="_blank" href="http://github.com/plataformatec/devise">Devise</a>, and <a target="_blank" href="http://railscasts.com/episodes/192-authorization-with-cancan">CanCan</a> (as well as non-Rails-specific solutions built on top of <a target="_blank" href="http://en.wikipedia.org/wiki/OpenID">OpenID</a> or <a target="_blank" href="http://en.wikipedia.org/wiki/Oauth">OAuth</a>).<span class="intersentencespace"></span> It’s reasonable to ask why we should reinvent the wheel.<span class="intersentencespace"></span> Why not just use an off-the-shelf solution instead of rolling our own?</p>
<p>For one, practical experience shows that authentication on most sites
 requires extensive customization, and modifying a third-party product 
is often more work than writing the system from scratch.<span class="intersentencespace"></span>
 In addition, off-the-shelf systems can be “black boxes”, with 
potentially mysterious innards; when you write your own system, you are 
far more likely to understand it.<span class="intersentencespace"></span> Moreover, recent additions to Rails (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-adding_a_secure_password">Section&nbsp;<span class="ref">6.3</span></a>) make it easy to write a custom authentication system.<span class="intersentencespace"></span> Finally, if you <em>do</em>
 end up using a third-party system later on, you’ll be in a much better 
position to understand and modify it if you’ve first built one yourself.<span class="intersentencespace"></span></p>

</div></div><div data-number="6.1" class="section" data-tralics-id="cid38" id="_sec-user_model"><h2><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-user_model"><span class="number">6.1 </span>User model</a></h2>
<p>Although the ultimate goal of the next three chapters is to make a signup page for our site (as mocked up in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-signup_mockup_preview">Figure&nbsp;<span class="ref">6.1</span></a>), it would do little good now to accept information for new users: we don’t currently have any place to put it.<span class="intersentencespace"></span> Thus, the first step in signing up users is to make a data structure to capture and store their information.</p>
<div data-number="6.1" data-tralics-id="uid508" id="_fig-signup_mockup_preview" class="center figure">
<div class="graphics image box"><img alt="images/figures/signup_mockup_bootstrap" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/signup_mockup_bootstrap.png"></div><div class="caption"><span class="header">Figure 6.1: </span><span class="description">A mockup of the user signup page.
</span></div></div>
<p>In Rails, the default data structure for a data model is called, naturally enough, a&nbsp;<em>model</em> (the M in MVC from <a class="hyperref" href="https://www.railstutorial.org/book/beginning#sec-mvc">Section&nbsp;<span class="ref">1.3.3</span></a>).<span class="intersentencespace"></span> The default Rails solution to the problem of persistence is to use a <em>database</em> for long-term data storage, and the default library for interacting with the database is called <em>Active Record</em>.<sup class="footnote" id="_cha-6_footnote-ref-1"><a href="#cha-6_footnote-1">1</a></sup><span class="intersentencespace"></span>
 Active Record comes with a host of methods for creating, saving, and 
finding data objects, all without having to use the structured query 
language (SQL)<sup class="footnote" id="_cha-6_footnote-ref-2"><a href="#cha-6_footnote-2">2</a></sup> used by <a target="_blank" href="http://en.wikipedia.org/wiki/Relational_database">relational databases</a>.<span class="intersentencespace"></span> Moreover, Rails has a feature called <em>migrations</em> to allow data definitions to be written in pure Ruby, without having to learn an SQL data definition language (DDL).<span class="intersentencespace"></span> The effect is that Rails insulates you almost entirely from the details of the data store.<span class="intersentencespace"></span> In this book, by using SQLite for development and PostgreSQL (via Heroku) for deployment (<a class="hyperref" href="https://www.railstutorial.org/book/beginning#sec-deploying">Section&nbsp;<span class="ref">1.5</span></a>),
 we have developed this theme even further, to the point where we barely
 ever have to think about how Rails stores data, even for production 
applications.</p>
<p>As usual, if you’re following along using Git for version control, 
now would be a good time to make a topic branch for modeling users:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git checkout -b modeling-users
</pre></div></div>
<div data-number="6.1.1" class="subsection" data-tralics-id="uid511" id="_sec-database_migrations"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-database_migrations"><span class="number">6.1.1 </span>Database migrations</a></h3>
<p>You may recall from <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_user_class">Section&nbsp;<span class="ref">4.4.5</span></a> that we have already encountered, via a custom-built <code>User</code> class, user objects with <code>name</code> and <code>email</code> attributes.<span class="intersentencespace"></span> That class served as a useful example, but it lacked the critical property of <em>persistence</em>: when we created a User object at the Rails console, it disappeared as soon as we exited.<span class="intersentencespace"></span> Our goal in this section is to create a model for users that won’t disappear quite so easily.</p>
<p>As with the User class in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_user_class">Section&nbsp;<span class="ref">4.4.5</span></a>, we’ll start by modeling a user with two attributes, a <code>name</code> and an <code>email</code> address, the latter of which we’ll use as a unique username.<sup class="footnote" id="_cha-6_footnote-ref-3"><a href="#cha-6_footnote-3">3</a></sup><span class="intersentencespace"></span> (We’ll add an attribute for passwords in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-adding_a_secure_password">Section&nbsp;<span class="ref">6.3</span></a>.)<span class="intersentencespace"></span> In <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#code-example_user">Listing&nbsp;<span class="ref">4.13</span></a>, we did this with Ruby’s <code>attr_accessor</code> method:</p>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span>
  <span class="kp">attr_accessor</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:email</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div>
<p>In contrast, when using Rails to model users we don’t need to identify the attributes explicitly.<span class="intersentencespace"></span> As noted briefly above, to store data Rails uses a relational database by default, which consists of <em>tables</em> composed of data <em>rows</em>, where each row has <em>columns</em> of data attributes.<span class="intersentencespace"></span> For example, to store users with names and email addresses, we’ll create a <code>users</code> table with <code>name</code> and <code>email</code> columns (with each row corresponding to one user).<span class="intersentencespace"></span> An example of such a table appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-users_table">Figure&nbsp;<span class="ref">6.2</span></a>, corresponding to the data model shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_sketch">Figure&nbsp;<span class="ref">6.3</span></a>.<span class="intersentencespace"></span> (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_sketch">Figure&nbsp;<span class="ref">6.3</span></a> is just a sketch; the full data model appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_initial">Figure&nbsp;<span class="ref">6.4</span></a>.)<span class="intersentencespace"></span> By naming the columns <code>name</code> and <code>email</code>, we’ll let Active Record figure out the User object attributes for us.</p>
<div data-number="6.2" data-tralics-id="uid513" id="_fig-users_table" class="center figure">
<div class="graphics image"><img alt="images/figures/users_table" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/users_table.png"></div><div class="caption"><span class="header">Figure 6.2: </span><span class="description">A diagram of sample data in a <code>users</code> table.
</span></div></div>
<div data-number="6.3" data-tralics-id="uid514" id="_fig-user_model_sketch" class="center figure">
<div class="graphics image"><img alt="images/figures/user_model_sketch" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/user_model_sketch.png"></div><div class="caption"><span class="header">Figure 6.3: </span><span class="description">A sketch of the User data model.
</span></div></div>
<p>You may recall from <a class="hyperref" href="https://www.railstutorial.org/book/filling_in_the_layout#code-generate_users_controller">Listing&nbsp;<span class="ref">5.28</span></a> that we created a Users controller (along with a <code>new</code> action) using the command</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Users new
</pre></div></div>
<p>The analogous command for making a model is <code>generate model</code>, which we can use to generate a User model with <code>name</code> and <code>email</code> attributes, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a>.</p>
<div data-number="6.1" data-tralics-id="uid515" id="_code-generate_user_model" class="codelisting"><div class="heading"><span class="number">Listing 6.1:</span> 

<span class="description">Generating a User model.</span>
</div>

<div class="code"><div class="highlight"><pre>$ rails generate model User name:string email:string
      invoke  active_record
      create    db/migrate/20140724010738_create_users.rb
      create    app/models/user.rb
      invoke    test_unit
      create      test/models/user_test.rb
      create      test/fixtures/users.yml
</pre></div></div></div><p>(Note that, in contrast to the plural convention for controller names, model names are singular: a <em>Users</em> controller, but a <em>User</em> model.)<span class="intersentencespace"></span> By passing the optional parameters <code>name:string</code> and <code>email:string</code>, we tell Rails about the two attributes we want, along with which types those attributes should be (in this case, <code>string</code>).<span class="intersentencespace"></span> Compare this with including the action names in <a class="hyperref" href="https://www.railstutorial.org/book/static_pages#code-generating_pages">Listing&nbsp;<span class="ref">3.4</span></a> and <a class="hyperref" href="https://www.railstutorial.org/book/filling_in_the_layout#code-generate_users_controller">Listing&nbsp;<span class="ref">5.28</span></a>.</p>
<p>One of the results of the <code>generate</code> command in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a> is a new file called a <em>migration</em>.<span class="intersentencespace"></span>
 Migrations provide a way to alter the structure of the database 
incrementally, so that our data model can adapt to changing 
requirements.<span class="intersentencespace"></span> In the case of the User model, the migration is created automatically by the model generation script; it creates a <code>users</code> table with two columns, <code>name</code> and <code>email</code>, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>.<span class="intersentencespace"></span> (We’ll see starting in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-uniqueness_validation">Section&nbsp;<span class="ref">6.2.5</span></a> how to make a migration from scratch.)</p>
<div data-number="6.2" data-tralics-id="uid516" id="_code-users_migration" class="codelisting"><div class="heading"><span class="number">Listing 6.2:</span> 

<span class="description">Migration for the User model (to create a <code>users</code> table).<span class="intersentencespace"></span> <span class="break"></span> <span class="filepath">db/migrate/[timestamp]_create_users.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CreateUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">create_table</span> <span class="ss">:users</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:name</span>
      <span class="n">t</span><span class="o">.</span><span class="n">string</span> <span class="ss">:email</span>

      <span class="n">t</span><span class="o">.</span><span class="n">timestamps</span> <span class="ss">null</span><span class="p">:</span> <span class="kp">false</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>Note that the name of the migration file is prefixed by a <em>timestamp</em> based on when the migration was generated.<span class="intersentencespace"></span>
 In the early days of migrations, the filenames were prefixed with 
incrementing integers, which caused conflicts for collaborating teams if
 multiple programmers had migrations with the same number.<span class="intersentencespace"></span> Barring the improbable scenario of migrations generated the same second, using timestamps conveniently avoids such collisions.</p>
<p>The migration itself consists of a <code>change</code> method that determines the change to be made to the database.<span class="intersentencespace"></span> In the case of <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>, <code>change</code> uses a Rails method called <code>create_table</code> to create a table in the database for storing users.<span class="intersentencespace"></span> The <code>create_table</code> method accepts a block (<a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-blocks">Section&nbsp;<span class="ref">4.3.2</span></a>) with one block variable, in this case called <code>t</code> (for “table”).<span class="intersentencespace"></span> Inside the block, the <code>create_table</code> method uses the <code>t</code>&nbsp;object to create <code>name</code> and <code>email</code> columns in the database, both of type <code>string</code>.<sup class="footnote" id="_cha-6_footnote-ref-4"><a href="#cha-6_footnote-4">4</a></sup><span class="intersentencespace"></span> Here the table name is plural (<code>users</code>)
 even though the model name is singular (User), which reflects a 
linguistic convention followed by Rails: a model represents a single 
user, whereas a database table consists of many users.<span class="intersentencespace"></span> The final line in the block, <code>t.timestamps null: false</code>, is a special command that creates two <em>magic columns</em> called <code>created_at</code> and <code>updated_at</code>, which are timestamps that automatically record when a given user is created and updated.<span class="intersentencespace"></span> (We’ll see concrete examples of the magic columns starting in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_user_objects">Section&nbsp;<span class="ref">6.1.3</span></a>.)<span class="intersentencespace"></span> The full data model represented by the migration in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a> is shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_initial">Figure&nbsp;<span class="ref">6.4</span></a>.<span class="intersentencespace"></span> (Note the addition of the magic columns, which weren’t present in the sketch shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_sketch">Figure&nbsp;<span class="ref">6.3</span></a>.)</p>
<div data-number="6.4" data-tralics-id="uid518" id="_fig-user_model_initial" class="center figure"><span class="graphics"><img alt="user_model_initial_3rd_edition" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/user_model_initial_3rd_edition.png"></span>
<div class="caption"><span class="header">Figure 6.4: </span><span class="description">The User data model produced by <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>.
</span></div></div>
<p>We can run the migration, known as “migrating up”, using the <code>rake</code> command (<a class="hyperref" href="https://www.railstutorial.org/book/toy_app#aside-rake">Box&nbsp;<span class="ref">2.1</span></a>) as follows:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake db:migrate
</pre></div></div>
<p>(You may recall that we ran this command in a similar context in <a class="hyperref" href="https://www.railstutorial.org/book/toy_app#sec-demo_users_resource">Section&nbsp;<span class="ref">2.2</span></a>.)<span class="intersentencespace"></span> The first time <code>db:migrate</code> is run, it creates a file called <code>db/development.sqlite3</code>, which is an <a target="_blank" href="http://sqlite.org/">SQLite</a><sup class="footnote" id="_cha-6_footnote-ref-5"><a href="#cha-6_footnote-5">5</a></sup> database.<span class="intersentencespace"></span> We can see the structure of the database by opening <code>development.sqlite3</code> with <a target="_blank" href="http://sqlitebrowser.org/">DB Browser for SQLite</a>.<span class="intersentencespace"></span> (If you’re using the cloud IDE, you should first download the database file to the local disk, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-sqlite_download">Figure&nbsp;<span class="ref">6.5</span></a>.)<span class="intersentencespace"></span> The result appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-sqlite_database_browser">Figure&nbsp;<span class="ref">6.6</span></a>); compare with the diagram in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_initial">Figure&nbsp;<span class="ref">6.4</span></a>.<span class="intersentencespace"></span> You might note that there’s one column in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-sqlite_database_browser">Figure&nbsp;<span class="ref">6.6</span></a> not accounted for in the migration: the <code>id</code> column.<span class="intersentencespace"></span> As noted briefly in <a class="hyperref" href="https://www.railstutorial.org/book/toy_app#sec-demo_users_resource">Section&nbsp;<span class="ref">2.2</span></a>, this column is created automatically, and is used by Rails to identify each row uniquely.</p>
<div data-number="6.5" data-tralics-id="uid520" id="_fig-sqlite_download" class="center figure">
<div class="graphics image"><img alt="images/figures/sqlite_download" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/sqlite_download.png"></div><div class="caption"><span class="header">Figure 6.5: </span><span class="description">Downloading a file from the cloud IDE.
</span></div></div>
<div data-number="6.6" data-tralics-id="uid521" id="_fig-sqlite_database_browser" class="center figure">
<div class="graphics image"><img alt="images/figures/sqlite_database_browser_3rd_edition" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/sqlite_database_browser_3rd_edition.png"></div><div class="caption"><span class="header">Figure 6.6: </span><span class="description">The <a target="_blank" href="http://sqlitebrowser.org/">DB Browser for SQLite</a> with our new <code>users</code> table.
</span></div></div>
<p>Most migrations (including all the ones in this tutorial) are <em>reversible</em>, which means we can “migrate down” and undo them with a single Rake task, called <code>db:rollback</code>:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake db:rollback
</pre></div></div>
<p>(See <a class="hyperref" href="https://www.railstutorial.org/book/static_pages#aside-undoing_things">Box&nbsp;<span class="ref">3.1</span></a> for another technique useful for reversing migrations.)<span class="intersentencespace"></span> Under the hood, this command executes the <code>drop_table</code> command to remove the users table from the database.<span class="intersentencespace"></span> The reason this works is that the <code>change</code> method knows that <code>drop_table</code> is the inverse of <code>create_table</code>, which means that the rollback migration can be easily inferred.<span class="intersentencespace"></span> In the case of an irreversible migration, such as one to remove a database column, it is necessary to define separate <code>up</code> and <code>down</code> methods in place of the single <code>change</code> method.<span class="intersentencespace"></span> Read about <a target="_blank" href="http://guides.rubyonrails.org/migrations.html">migrations in the Rails Guides</a> for more information.</p>
<p>If you rolled back the database, migrate up again before proceeding:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake db:migrate
</pre></div></div>
</div>
<div data-number="6.1.2" class="subsection" data-tralics-id="uid522" id="_sec-the_model_file"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-the_model_file"><span class="number">6.1.2 </span>The model file</a></h3>
<p>We’ve seen how the User model generation in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a> generated a migration file (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>), and we saw in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-sqlite_database_browser">Figure&nbsp;<span class="ref">6.6</span></a> the results of running this migration: it updated a file called <code>development.sqlite3</code> by creating a table <code>users</code> with columns <code>id</code>, <code>name</code>, <code>email</code>, <code>created_at</code>, and <code>updated_at</code>.<span class="intersentencespace"></span> <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a> also created the model itself.<span class="intersentencespace"></span> The rest of this section is dedicated to understanding it.</p>
<p>We begin by looking at the code for the User model, which lives in the file <code>user.rb</code> inside the <code>app/models/</code> directory.<span class="intersentencespace"></span> It is, to put it mildly, very compact (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-raw_user_model">Listing&nbsp;<span class="ref">6.3</span></a>).</p>
<div data-number="6.3" data-tralics-id="uid523" id="_code-raw_user_model" class="codelisting"><div class="heading"><span class="number">Listing 6.3:</span> 

<span class="description">The brand new User model.<span class="intersentencespace"></span> <span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div></div></div><p>Recall from <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_class_of_our_own">Section&nbsp;<span class="ref">4.4.2</span></a> that the syntax <code>class User &lt; ActiveRecord::Base</code> means that the <code>User</code> class <em>inherits</em> from <code>ActiveRecord::Base</code>, so that the User model automatically has all the functionality of the <code>ActiveRecord::Base</code> class.<span class="intersentencespace"></span> Of course, this knowledge doesn’t do us any good unless we know what <code>ActiveRecord::Base</code> contains, so let’s get started with some concrete examples.</p>
</div>
<div data-number="6.1.3" class="subsection" data-tralics-id="uid524" id="_sec-creating_user_objects"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_user_objects"><span class="number">6.1.3 </span>Creating user objects</a></h3>
<p>As in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#cha-rails_flavored_ruby">Chapter&nbsp;<span class="ref">4</span></a>, our tool of choice for exploring data models is the Rails console.<span class="intersentencespace"></span> Since we don’t (yet) want to make any changes to our database, we’ll start the console in a <em>sandbox</em>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails console --sandbox
<span class="go">Loading development environment in sandbox</span>
<span class="go">Any modifications you make will be rolled back on exit</span>
<span class="gp">&gt;</span>&gt;
</pre></div></div>
<p>As indicated by the helpful message “Any modifications you make will 
be rolled back on exit”, when started in a sandbox the console will 
“roll back” (i.e., undo) any database changes introduced during the 
session.</p>
<p>In the console session in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_user_class">Section&nbsp;<span class="ref">4.4.5</span></a>, we created a new user object with <code>User.new</code>, which we had access to only after requiring the example user file in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#code-example_user">Listing&nbsp;<span class="ref">4.13</span></a>.<span class="intersentencespace"></span> With models, the situation is different; as you may recall from <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_controller_class">Section&nbsp;<span class="ref">4.4.4</span></a>, the Rails console automatically loads the Rails environment, which includes the models.<span class="intersentencespace"></span> This means that we can make a new user object without any further work:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">new</span>
<span class="go">=&gt; #&lt;User id: nil, name: nil, email: nil, created_at: nil, updated_at: nil&gt;</span>
</pre></div></div>
<p>We see here the default console representation of a user object.</p>
<p>When called with no arguments, <code>User.new</code> returns an object with all <code>nil</code> attributes.<span class="intersentencespace"></span> In <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_user_class">Section&nbsp;<span class="ref">4.4.5</span></a>, we designed the example User class to take an <em>initialization hash</em>
 to set the object attributes; that design choice was motivated by 
Active Record, which allows objects to be initialized in the same way:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Michael Hartl"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"mhartl@example.com"</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: nil, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: nil, updated_at: nil&gt;</span>
</pre></div></div>
<p>Here we see that the name and email attributes have been set as expected.</p>
<p>The notion of <em>validity</em> is important for understanding Active Record model objects.<span class="intersentencespace"></span> We’ll explore this subject in more depth in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-user_validations">Section&nbsp;<span class="ref">6.2</span></a>, but for now it’s worth noting that our initial <code>user</code> object is valid, which we can verify by calling the boolean <code>valid?</code> method on it:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">valid?</span>
<span class="go">true</span>
</pre></div></div>
<p>So far, we haven’t touched the database: <code>User.new</code> only creates an object <em>in memory</em>, while <code>user.valid?</code> merely checks to see if the object is valid.<span class="intersentencespace"></span> In order to save the User object to the database, we need to call the <code>save</code> method on the <code>user</code> variable:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span>
<span class="go">   (0.2ms)  begin transaction</span>
<span class="go">  User Exists (0.2ms)  SELECT  1 AS one FROM "users"  WHERE LOWER("users".</span>
<span class="go">  "email") = LOWER('mhartl@example.com') LIMIT 1</span>
<span class="go">  SQL (0.5ms)  INSERT INTO "users" ("created_at", "email", "name", "updated_at)</span>
<span class="go">   VALUES (?, ?, ?, ?)  [["created_at", "2014-09-11 14:32:14.199519"],</span>
<span class="go">   ["email", "mhartl@example.com"], ["name", "Michael Hartl"], ["updated_at",</span>
<span class="go">  "2014-09-11 14:32:14.199519"]]</span>
<span class="go">   (0.9ms)  commit transaction</span>
<span class="go">=&gt; true</span>
</pre></div></div>
<p>The <code>save</code> method returns <code>true</code> if it succeeds and <code>false</code> otherwise.<span class="intersentencespace"></span> (Currently, all saves should succeed because there are as yet no validations; we’ll see cases in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-user_validations">Section&nbsp;<span class="ref">6.2</span></a> when some will fail.)<span class="intersentencespace"></span> For reference, the Rails console also shows the SQL command corresponding to <code>user.save</code> (namely, <code>INSERT INTO "users"</code>…).<span class="intersentencespace"></span> We’ll hardly ever need raw SQL in this book,<sup class="footnote" id="_cha-6_footnote-ref-6"><a href="#cha-6_footnote-6">6</a></sup>
 and I’ll omit discussion of the SQL commands from now on, but you can 
learn a lot by reading the SQL corresponding to Active Record commands.</p>
<p>You may have noticed that the new user object had <code>nil</code> values for the <code>id</code> and the magic columns <code>created_at</code> and <code>updated_at</code> attributes.<span class="intersentencespace"></span> Let’s see if our <code>save</code> changed anything:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-07-24 00:57:46", updated_at: "2014-07-24 00:57:46"&gt;</span>
</pre></div></div>
<p>We see that the <code>id</code> has been assigned a value of&nbsp;<code>1</code>, while the magic columns have been assigned the current time and date.<sup class="footnote" id="_cha-6_footnote-ref-7"><a href="#cha-6_footnote-7">7</a></sup><span class="intersentencespace"></span> Currently, the created and updated timestamps are identical; we’ll see them differ in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-updating_user_objects">Section&nbsp;<span class="ref">6.1.5</span></a>.</p>
<p>As with the User class in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_user_class">Section&nbsp;<span class="ref">4.4.5</span></a>, instances of the User model allow access to their attributes using a dot notation:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">name</span>
<span class="go">=&gt; "Michael Hartl"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="go">=&gt; "mhartl@example.com"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">updated_at</span>
<span class="go">=&gt; Thu, 24 Jul 2014 00:57:46 UTC +00:00</span>
</pre></div></div>
<p>As we’ll see in <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>,
 it’s often convenient to make and save a model in two steps as we have 
above, but Active Record also lets you combine them into one step with <code>User.create</code>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"A Nother"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"another@example.org"</span><span class="p">)</span>
<span class="go">#&lt;User id: 2, name: "A Nother", email: "another@example.org", created_at:</span>
<span class="go">"2014-07-24 01:05:24", updated_at: "2014-07-24 01:05:24"&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">foo</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Foo"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"foo@bar.com"</span><span class="p">)</span>
<span class="go">#&lt;User id: 3, name: "Foo", email: "foo@bar.com", created_at: "2014-07-24</span>
<span class="go">01:05:42", updated_at: "2014-07-24 01:05:42"&gt;</span>
</pre></div></div>
<p>Note that <code>User.create</code>, rather than returning <code>true</code> or <code>false</code>, returns the User object itself, which we can optionally assign to a variable (such as <code>foo</code> in the second command above).</p>
<p>The inverse of <code>create</code> is <code>destroy</code>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">foo</span><span class="o">.</span><span class="n">destroy</span>
<span class="go">=&gt; #&lt;User id: 3, name: "Foo", email: "foo@bar.com", created_at: "2014-07-24</span>
<span class="go">01:05:42", updated_at: "2014-07-24 01:05:42"&gt;</span>
</pre></div></div>
<p>Like <code>create</code>, <code>destroy</code> returns the object in question, though I can’t recall ever having used the return value of <code>destroy</code>.<span class="intersentencespace"></span> In addition, the destroyed object still exists in memory:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">foo</span>
<span class="go">=&gt; #&lt;User id: 3, name: "Foo", email: "foo@bar.com", created_at: "2014-07-24</span>
<span class="go">01:05:42", updated_at: "2014-07-24 01:05:42"&gt;</span>
</pre></div></div>
<p>So how do we know if we really destroyed an object?<span class="intersentencespace"></span> And for saved and non-destroyed objects, how can we retrieve users from the database?<span class="intersentencespace"></span> To answer these questions, we need to learn how to use Active Record to find user objects.</p>
</div>
<div data-number="6.1.4" class="subsection" data-tralics-id="uid527" id="_sec-finding_user_objects"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-finding_user_objects"><span class="number">6.1.4 </span>Finding user objects</a></h3>
<p>Active Record provides several options for finding objects.<span class="intersentencespace"></span> Let’s use them to find the first user we created while verifying that the third user (<code>foo</code>) has been destroyed.<span class="intersentencespace"></span> We’ll start with the existing user:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-07-24 00:57:46", updated_at: "2014-07-24 00:57:46"&gt;</span>
</pre></div></div>
<p>Here we’ve passed the id of the user to <code>User.find</code>; Active Record returns the user with that&nbsp;id.</p>
<p>Let’s see if the user with an <code>id</code> of&nbsp;<code>3</code> still exists in the database:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">ActiveRecord::RecordNotFound: Couldn't find User with ID=3</span>
</pre></div></div>
<p>Since we destroyed our third user in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_user_objects">Section&nbsp;<span class="ref">6.1.3</span></a>, Active Record can’t find it in the database.<span class="intersentencespace"></span> Instead, <code>find</code> raises an <em>exception</em>,
 which is a way of indicating an exceptional event in the execution of a
 program—in this case, a nonexistent Active Record id, which causes <code>find</code> to raise an <code>ActiveRecord::RecordNotFound</code> exception.<sup class="footnote" id="_cha-6_footnote-ref-8"><a href="#cha-6_footnote-8">8</a></sup></p>
<p>In addition to the generic <code>find</code>, Active Record also allows us to find users by specific attributes:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s2">"mhartl@example.com"</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-07-24 00:57:46", updated_at: "2014-07-24 00:57:46"&gt;</span>
</pre></div></div>
<p>Since we will be using email addresses as usernames, this sort of <code>find</code> will be useful when we learn how to let users log in to our site (<a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>).<span class="intersentencespace"></span> If you’re worried that <code>find_by</code>
 will be inefficient if there are a large number of users, you’re ahead 
of the game; we’ll cover this issue, and its solution via database 
indices, in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-uniqueness_validation">Section&nbsp;<span class="ref">6.2.5</span></a>.</p>
<p>We’ll end with a couple of more general ways of finding users.<span class="intersentencespace"></span> First, there’s <code>first</code>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-07-24 00:57:46", updated_at: "2014-07-24 00:57:46"&gt;</span>
</pre></div></div>
<p>Naturally, <code>first</code> just returns the first user in the database.<span class="intersentencespace"></span> There’s also <code>all</code>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">all</span>
<span class="go">=&gt; #&lt;ActiveRecord::Relation [#&lt;User id: 1, name: "Michael Hartl",</span>
<span class="go">email: "mhartl@example.com", created_at: "2014-07-24 00:57:46",</span>
<span class="go">updated_at: "2014-07-24 00:57:46"&gt;, #&lt;User id: 2, name: "A Nother",</span>
<span class="go">email: "another@example.org", created_at: "2014-07-24 01:05:24",</span>
<span class="go">updated_at: "2014-07-24 01:05:24"&gt;]&gt;</span>
</pre></div></div>
<p>As you can see from the console output, <code>User.all</code> returns all the users in the database as an object of class <code>ActiveRecord::Relation</code>, which is effectively an array (<a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-arrays_and_ranges">Section&nbsp;<span class="ref">4.3.1</span></a>).</p>
</div>
<div data-number="6.1.5" class="subsection" data-tralics-id="uid529" id="_sec-updating_user_objects"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-updating_user_objects"><span class="number">6.1.5 </span>Updating user objects</a></h3>
<p>Once we’ve created objects, we often want to update them.<span class="intersentencespace"></span> There are two basic ways to do this.<span class="intersentencespace"></span> First, we can assign attributes individually, as we did in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_user_class">Section&nbsp;<span class="ref">4.4.5</span></a>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span>           <span class="c1"># Just a reminder about our user's attributes</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-07-24 00:57:46", updated_at: "2014-07-24 00:57:46"&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">"mhartl@example.net"</span>
<span class="go">=&gt; "mhartl@example.net"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span>
<span class="go">=&gt; true</span>
</pre></div></div>
<p>Note that the final step is necessary to write the changes to the database.<span class="intersentencespace"></span> We can see what happens without a save by using <code>reload</code>, which reloads the object based on the database information:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="go">=&gt; "mhartl@example.net"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">"foo@bar.com"</span>
<span class="go">=&gt; "foo@bar.com"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">reload</span><span class="o">.</span><span class="n">email</span>
<span class="go">=&gt; "mhartl@example.net"</span>
</pre></div></div>
<p>Now that we’ve updated the user by running <code>user.save</code>, the magic columns differ, as promised in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_user_objects">Section&nbsp;<span class="ref">6.1.3</span></a>:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">created_at</span>
<span class="go">=&gt; "2014-07-24 00:57:46"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">updated_at</span>
<span class="go">=&gt; "2014-07-24 01:37:32"</span>
</pre></div></div>
<p>The second main way to update multiple attributes is to use <code>update_attributes</code>:<sup class="footnote" id="_cha-6_footnote-ref-9"><a href="#cha-6_footnote-9">9</a></sup></p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"The Dude"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"dude@abides.org"</span><span class="p">)</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">name</span>
<span class="go">=&gt; "The Dude"</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">email</span>
<span class="go">=&gt; "dude@abides.org"</span>
</pre></div></div>
<p>The <code>update_attributes</code> method accepts a hash of attributes, and on success performs both the update and the save in one step (returning <code>true</code> to indicate that the save went through).<span class="intersentencespace"></span> Note that if any of the validations fail, such as when a password is required to save a record (as implemented in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-adding_a_secure_password">Section&nbsp;<span class="ref">6.3</span></a>), the call to <code>update_attributes</code> will fail.<span class="intersentencespace"></span> If we need to update only a single attribute, using the singular <code>update_attribute</code> bypasses this restriction:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">update_attribute</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="s2">"The Dude"</span><span class="p">)</span>
<span class="go">=&gt; true</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">name</span>
<span class="go">=&gt; "The Dude"</span>
</pre></div></div>
</div></div><div data-number="6.2" class="section" data-tralics-id="cid39" id="_sec-user_validations"><h2><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-user_validations"><span class="number">6.2 </span>User validations</a></h2>
<p>The User model we created in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-user_model">Section&nbsp;<span class="ref">6.1</span></a> now has working <code>name</code> and <code>email</code> attributes, but they are completely generic: any string (including an empty one) is currently valid in either case.<span class="intersentencespace"></span> And yet, names and email addresses are more specific than this.<span class="intersentencespace"></span> For example, <code>name</code> should be non-blank, and <code>email</code> should match the specific format characteristic of email addresses.<span class="intersentencespace"></span>
 Moreover, since we’ll be using email addresses as unique usernames when
 users log in, we shouldn’t allow email duplicates in the database.</p>
<p>In short, we shouldn’t allow <code>name</code> and <code>email</code> to be just any strings; we should enforce certain constraints on their values.<span class="intersentencespace"></span> Active Record allows us to impose such constraints using <em>validations</em> (seen briefly before in <a class="hyperref" href="https://www.railstutorial.org/book/toy_app#sec-putting_the_micro_in_microposts">Section&nbsp;<span class="ref">2.3.2</span></a>).<span class="intersentencespace"></span> In this section, we’ll cover several of the most common cases, validating <em>presence</em>, <em>length</em>, <em>format</em> and <em>uniqueness</em>.<span class="intersentencespace"></span> In <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-has_secure_password">Section&nbsp;<span class="ref">6.3.2</span></a> we’ll add a final common validation, <em>confirmation</em>.<span class="intersentencespace"></span> And we’ll see in <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#sec-unsuccessful_signups">Section&nbsp;<span class="ref">7.3</span></a> how validations give us convenient error messages when users make submissions that violate them.</p>
<div data-number="6.2.1" class="subsection" data-tralics-id="uid531" id="_sec-a_validity_test"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-a_validity_test"><span class="number">6.2.1 </span>A validity test</a></h3>
<p>As noted in <a class="hyperref" href="https://www.railstutorial.org/book/static_pages#aside-when_to_test">Box&nbsp;<span class="ref">3.3</span></a>,
 test-driven development isn’t always the right tool for the job, but 
model validations are exactly the kind of features for which TDD is a 
perfect fit.<span class="intersentencespace"></span> It’s difficult to 
be confident that a given validation is doing exactly what we expect it 
to without writing a failing test and then getting it to pass.</p>
<p>Our method will be to start with a <em>valid</em> model object, set one of its attributes to something we want to be invalid, and then test that it in fact is invalid.<span class="intersentencespace"></span> As a safety net, we’ll first write a test to make sure the initial model object is valid.<span class="intersentencespace"></span>
 This way, when the validation tests fail we’ll know it’s for the right 
reason (and not because the initial object was invalid in the first 
place).</p>
<p>To get us started, the command in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a> produced an initial test for testing users, though in this case it’s practically blank (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-default_user_test">Listing&nbsp;<span class="ref">6.4</span></a>).</p>
<div data-number="6.4" data-tralics-id="uid532" id="_code-default_user_test" class="codelisting"><div class="heading"><span class="number">Listing 6.4:</span> 

<span class="description">The practically blank default User test.<span class="intersentencespace"></span> <span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>
  <span class="c1"># test "the truth" do</span>
  <span class="c1">#   assert true</span>
  <span class="c1"># end</span>
<span class="k">end</span>
</pre></div></div></div><p>To write a test for a valid object, we’ll create an initially valid User model object <code>@user</code> using the special <code>setup</code> method (discussed briefly in the <a class="hyperref" href="https://www.railstutorial.org/book/static_pages#cha-static_pages">Chapter&nbsp;<span class="ref">3</span></a> exercises), which automatically gets run before each test.<span class="intersentencespace"></span> Because <code>@user</code> is an instance variable, it’s automatically available in all the tests, and we can test its validity using the <code>valid?</code> method (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_user_objects">Section&nbsp;<span class="ref">6.1.3</span></a>).<span class="intersentencespace"></span> The result appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-valid_user_test">Listing&nbsp;<span class="ref">6.5</span></a>.</p>
<div data-number="6.5" data-tralics-id="uid533" id="_code-valid_user_test" class="codelisting"><div class="heading"><span class="number">Listing 6.5:</span> 

<span class="description">A test for an initially valid user.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should be valid"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p><a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-valid_user_test">Listing&nbsp;<span class="ref">6.5</span></a> uses the plain <code>assert</code> method, which in this case succeeds if <code>@user.valid?</code><span class="intersentencespace"></span> returns <code>true</code> and fails if it returns <code>false</code>.</p>
<p>Because our User model doesn’t currently have any validations, the initial test should pass:</p>
<div data-number="6.6" data-tralics-id="uid534" id="_uid534" class="codelisting"><div class="heading"><span class="number">Listing 6.6:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test:models
</pre></div></div></div><p>Here we’ve used <code>rake test:models</code> to run just the model tests (compare to <code>rake test:integration</code> from <a class="hyperref" href="https://www.railstutorial.org/book/filling_in_the_layout#sec-layout_link_tests">Section&nbsp;<span class="ref">5.3.4</span></a>).</p>
</div>
<div data-number="6.2.2" class="subsection" data-tralics-id="uid535" id="_sec-presence_validation"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-presence_validation"><span class="number">6.2.2 </span>Validating presence</a></h3>
<p>Perhaps the most elementary validation is <em>presence</em>, which simply verifies that a given attribute is present.<span class="intersentencespace"></span>
 For example, in this section we’ll ensure that both the name and email 
fields are present before a user gets saved to the database.<span class="intersentencespace"></span> In <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#sec-signup_error_messages">Section&nbsp;<span class="ref">7.3.3</span></a>, we’ll see how to propagate this requirement up to the signup form for creating new users.</p>
<p>We’ll start with a test for the presence of a <code>name</code> attribute by building on the test in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-valid_user_test">Listing&nbsp;<span class="ref">6.5</span></a>.<span class="intersentencespace"></span> As seen in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-name_presence_test">Listing&nbsp;<span class="ref">6.7</span></a>, all we need to do is set the <code>@user</code> variable’s <code>name</code> attribute to a blank string (in this case, a string of spaces) and then check (using the <code>assert_not</code> method) that the resulting User object is not valid.</p>
<div data-number="6.7" data-tralics-id="uid536" id="_code-name_presence_test" class="codelisting"><div class="heading"><span class="number">Listing 6.7:</span> 

<span class="description">A test for validation of the <code>name</code> attribute.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should be valid"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

<span class="hll">  <span class="nb">test</span> <span class="s2">"name should be present"</span> <span class="k">do</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"     "</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div></div><p>At this point, the model tests should be <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.8" data-tralics-id="uid537" id="_uid537" class="codelisting"><div class="heading"><span class="number">Listing 6.8:</span> <span class="description"><span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test:models
</pre></div></div></div><p>As we saw briefly before in the <a class="hyperref" href="https://www.railstutorial.org/book/toy_app#cha-a_toy_app">Chapter&nbsp;<span class="ref">2</span></a> exercises, the way to validate the presence of the name attribute is to use the <code>validates</code> method with argument <code>presence: true</code>, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_presence_of_name">Listing&nbsp;<span class="ref">6.9</span></a>.<span class="intersentencespace"></span> The <code>presence: true</code> argument is a one-element <em>options hash</em>; recall from <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-css_revisited">Section&nbsp;<span class="ref">4.3.4</span></a> that curly braces are optional when passing hashes as the final argument in a method.<span class="intersentencespace"></span> (As noted in <a class="hyperref" href="https://www.railstutorial.org/book/filling_in_the_layout#sec-adding_to_the_layout">Section&nbsp;<span class="ref">5.1.1</span></a>, the use of options hashes is a recurring theme in Rails.)</p>
<div data-number="6.9" data-tralics-id="uid538" id="_code-validates_presence_of_name" class="codelisting"><div class="heading"><span class="number">Listing 6.9:</span> 

<span class="description">Validating the presence of a <code>name</code> attribute.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class="k">end</span>
</pre></div></div></div><p><a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_presence_of_name">Listing&nbsp;<span class="ref">6.9</span></a> may look like magic, but <code>validates</code> is just a method.<span class="intersentencespace"></span> An equivalent formulation of <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_presence_of_name">Listing&nbsp;<span class="ref">6.9</span></a> using parentheses is as follows:</p>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span><span class="p">(</span><span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div>
<p>Let’s drop into the console to see the effects of adding a validation to our User model:<sup class="footnote" id="_cha-6_footnote-ref-10"><a href="#cha-6_footnote-10">10</a></sup></p>
<div class="code"><div class="highlight"><pre><span class="go">$ rails console --sandbox</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"mhartl@example.com"</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">valid?</span>
<span class="go">=&gt; false</span>
</pre></div></div>
<p>Here we check the validity of the <code>user</code> variable using the <code>valid?</code> method, which returns <code>false</code> when the object fails one or more validations, and <code>true</code> when all validations pass.<span class="intersentencespace"></span> In this case, we only have one validation, so we know which one failed, but it can still be helpful to check using the <code>errors</code> object generated on failure:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span>
<span class="go">=&gt; ["Name can't be blank"]</span>
</pre></div></div>
<p>(The error message is a hint that Rails validates the presence of an attribute using the <code>blank?</code> method, which we saw at the end of <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-modifying_built_in_classes">Section&nbsp;<span class="ref">4.4.3</span></a>.)</p>
<p>Because the user isn’t valid, an attempt to save the user to the database automatically fails:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span>
<span class="go">=&gt; false</span>
</pre></div></div>
<p>As a result, the test in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-name_presence_test">Listing&nbsp;<span class="ref">6.7</span></a> should now be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.10" data-tralics-id="uid540" id="_uid540" class="codelisting"><div class="heading"><span class="number">Listing 6.10:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test:models
</pre></div></div></div><p>Following the model in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-name_presence_test">Listing&nbsp;<span class="ref">6.7</span></a>, writing a test for <code>email</code> attribute presence is easy (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_presence_test">Listing&nbsp;<span class="ref">6.11</span></a>), as is the application code to get it to pass (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_presence_of_email">Listing&nbsp;<span class="ref">6.12</span></a>).</p>
<div data-number="6.11" data-tralics-id="uid541" id="_code-email_presence_test" class="codelisting"><div class="heading"><span class="number">Listing 6.11:</span> 

<span class="description">A test for validation of the <code>email</code> attribute.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"should be valid"</span> <span class="k">do</span>
    <span class="n">assert</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"name should be present"</span> <span class="k">do</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">""</span>
    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

<span class="hll">  <span class="nb">test</span> <span class="s2">"email should be present"</span> <span class="k">do</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">"     "</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div></div><div data-number="6.12" data-tralics-id="uid542" id="_code-validates_presence_of_email" class="codelisting"><div class="heading"><span class="number">Listing 6.12:</span> 

<span class="description">Validating the presence of an <code>email</code> attribute.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
<span class="hll">  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class="k">end</span>
</pre></div></div></div><p>At this point, the presence validations are complete, and the test suite should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.13" data-tralics-id="uid543" id="_uid543" class="codelisting"><div class="heading"><span class="number">Listing 6.13:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div></div>
<div data-number="6.2.3" class="subsection" data-tralics-id="uid544" id="_sec-length_validation"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-length_validation"><span class="number">6.2.3 </span>Length validation</a></h3>
<p>We’ve constrained our User model to require a name for each user, but
 we should go further: the user’s names will be displayed on the sample 
site, so we should enforce some limit on their length.<span class="intersentencespace"></span> With all the work we did in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-presence_validation">Section&nbsp;<span class="ref">6.2.2</span></a>, this step is easy.</p>
<p>There’s no science to picking a maximum length; we’ll just pull&nbsp;<code>50</code> out of thin air as a reasonable upper bound, which means verifying that names of&nbsp;<code>51</code> characters are too long.<span class="intersentencespace"></span>
 In addition, although it’s unlikely ever to be a problem, there’s a 
chance that a user’s email address could overrun the maximum length of 
strings, which for many databases is 255.<span class="intersentencespace"></span> Because the format validation in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-format_validation">Section&nbsp;<span class="ref">6.2.4</span></a> won’t enforce such a constraint, we’ll add one in this section for completeness.<span class="intersentencespace"></span> <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-length_validation_test">Listing&nbsp;<span class="ref">6.14</span></a> shows the resulting tests.</p>
<div data-number="6.14" data-tralics-id="uid545" id="_code-length_validation_test" class="codelisting"><div class="heading"><span class="number">Listing 6.14:</span> 

<span class="description">A test for <code>name</code> length validation.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"name should not be too long"</span> <span class="k">do</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">51</span>
    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

  <span class="nb">test</span> <span class="s2">"email should not be too long"</span> <span class="k">do</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">244</span> <span class="o">+</span> <span class="s2">"@example.com"</span>
    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>For convenience, we’ve used “string multiplication” in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-length_validation_test">Listing&nbsp;<span class="ref">6.14</span></a> to make a string 51 characters long.<span class="intersentencespace"></span> We can see how this works using the console:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">"a"</span> <span class="o">*</span> <span class="mi">51</span>
<span class="go">=&gt; "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s2">"a"</span> <span class="o">*</span> <span class="mi">51</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="go">=&gt; 51</span>
</pre></div></div>
<p>The email length validation arranges to make a valid email address that’s one character too long:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="s2">"a"</span> <span class="o">*</span> <span class="mi">244</span> <span class="o">+</span> <span class="s2">"@example.com"</span>
<span class="go">=&gt; "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>
<span class="go">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>
<span class="go">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span>
<span class="go">aaaaaaaaaaa@example.com"</span>
<span class="gp">&gt;&gt; </span><span class="p">(</span><span class="s2">"a"</span> <span class="o">*</span> <span class="mi">244</span> <span class="o">+</span> <span class="s2">"@example.com"</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="go">=&gt; 256</span>
</pre></div></div>
<p>At this point, the tests in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-length_validation_test">Listing&nbsp;<span class="ref">6.14</span></a> should be <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.15" data-tralics-id="uid546" id="_uid546" class="codelisting"><div class="heading"><span class="number">Listing 6.15:</span> <span class="description"><span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div><p>To get them to pass, we need to use the validation argument to constrain length, which is just <code>length</code>, along with the <code>maximum</code> parameter to enforce the upper bound (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-length_validation">Listing&nbsp;<span class="ref">6.16</span></a>).</p>
<div data-number="6.16" data-tralics-id="uid547" id="_code-length_validation" class="codelisting"><div class="heading"><span class="number">Listing 6.16:</span> 

<span class="description">Adding a length validation for the <code>name</code> attribute.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
</span>  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div><p>Now the tests should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.17" data-tralics-id="uid548" id="_uid548" class="codelisting"><div class="heading"><span class="number">Listing 6.17:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div><p>With our test suite passing again, we can move on to a more challenging validation: email format.</p>
</div>
<div data-number="6.2.4" class="subsection" data-tralics-id="uid549" id="_sec-format_validation"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-format_validation"><span class="number">6.2.4 </span>Format validation</a></h3>
<p>Our validations for the <code>name</code> attribute enforce only minimal constraints—any non-blank name under 51 characters will do—but of course the <code>email</code> attribute must satisfy the more stringent requirement of being a valid email address.<span class="intersentencespace"></span>
 So far we’ve only rejected blank email addresses; in this section, 
we’ll require email addresses to conform to the familiar pattern <code>user@example.com</code>.</p>
<p>Neither the tests nor the validation will be exhaustive, just good 
enough to accept most valid email addresses and reject most invalid 
ones.<span class="intersentencespace"></span> We’ll start with a couple of tests involving collections of valid and invalid addresses.<span class="intersentencespace"></span> To make these collections, it’s worth knowing about the useful <code>%w[]</code> technique for making arrays of strings, as seen in this console session:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="sx">%w[foo bar baz]</span>
<span class="go">=&gt; ["foo", "bar", "baz"]</span>
<span class="gp">&gt;&gt; </span><span class="n">addresses</span> <span class="o">=</span> <span class="sx">%w[USER@foo.COM THE_US-ER@foo.bar.org first.last@foo.jp]</span>
<span class="go">=&gt; ["USER@foo.COM", "THE_US-ER@foo.bar.org", "first.last@foo.jp"]</span>
<span class="gp">&gt;&gt; </span><span class="n">addresses</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">address</span><span class="o">|</span>
<span class="gp">?&gt; </span>  <span class="nb">puts</span> <span class="n">address</span>
<span class="gp">&gt;&gt; </span><span class="k">end</span>
<span class="go">USER@foo.COM</span>
<span class="go">THE_US-ER@foo.bar.org</span>
<span class="go">first.last@foo.jp</span>
</pre></div></div>
<p>Here we’ve iterated over the elements of the <code>addresses</code> array using the <code>each</code> method (<a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-blocks">Section&nbsp;<span class="ref">4.3.2</span></a>).<span class="intersentencespace"></span> With this technique in hand, we’re ready to write some basic email format validation tests.</p>
<p>Because email format validation is tricky and error-prone, we’ll start with some passing tests for <em>valid</em> email addresses to catch any errors in the validation.<span class="intersentencespace"></span> In other words, we want to make sure not just that invalid email addresses like <em>user@example,com</em> are rejected, but also that valid addresses like <em>user@example.com</em> are accepted, even after we impose the validation constraint.<span class="intersentencespace"></span> (Right now, of course, they’ll be accepted because all non-blank email addresses are currently valid.)<span class="intersentencespace"></span> The result for a representative sample of valid email addresses appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_format_valid_tests">Listing&nbsp;<span class="ref">6.18</span></a>.</p>
<div data-number="6.18" data-tralics-id="uid550" id="_code-email_format_valid_tests" class="codelisting"><div class="heading"><span class="number">Listing 6.18:</span> 

<span class="description">Tests for valid email formats.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"email validation should accept valid addresses"</span> <span class="k">do</span>
    <span class="n">valid_addresses</span> <span class="o">=</span> <span class="sx">%w[user@example.com USER@foo.COM A_US-ER@foo.bar.org</span>
<span class="sx">                         first.last@foo.jp alice+bob@baz.cn]</span>
    <span class="n">valid_addresses</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">valid_address</span><span class="o">|</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">valid_address</span>
      <span class="n">assert</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">valid_address</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2"> should be valid"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>Note that we’ve included an optional second 
argument to the assertion with a custom error message, which in this 
case identifies the address causing the test to fail:</p>
<div class="code"><div class="highlight"><pre><span class="n">assert</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">valid_address</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2"> should be valid"</span>
</pre></div></div>
<p>(This uses the interpolated <code>inspect</code> method mentioned in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-hashes_and_symbols">Section&nbsp;<span class="ref">4.3.3</span></a>.)<span class="intersentencespace"></span> Including the specific address that causes any failure is especially useful in a test with an <code>each</code> loop like <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_format_valid_tests">Listing&nbsp;<span class="ref">6.18</span></a>;
 otherwise, any failure would merely identify the line number, which is 
the same for all the email addresses, and which wouldn’t be sufficient 
to identify the source of the problem.</p>
<p>Next we’ll add tests for the <em>invalidity</em> of a variety of invalid email addresses, such as <em>user@example,com</em> (comma in place of dot) and <em>user_at_foo.org</em> (missing the ‘@’ sign).<span class="intersentencespace"></span> As in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_format_valid_tests">Listing&nbsp;<span class="ref">6.18</span></a>, <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_format_validation_tests">Listing&nbsp;<span class="ref">6.19</span></a> includes a custom error message to identify the exact address causing any failure.</p>
<div data-number="6.19" data-tralics-id="uid551" id="_code-email_format_validation_tests" class="codelisting"><div class="heading"><span class="number">Listing 6.19:</span> 

<span class="description">Tests for email format validation.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"email validation should reject invalid addresses"</span> <span class="k">do</span>
    <span class="n">invalid_addresses</span> <span class="o">=</span> <span class="sx">%w[user@example,com user_at_foo.org user.name@example.</span>
<span class="sx">                           foo@bar_baz.com foo@bar+baz.com]</span>
    <span class="n">invalid_addresses</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">invalid_address</span><span class="o">|</span>
      <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">invalid_address</span>
      <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span><span class="p">,</span> <span class="s2">"</span><span class="si">#{</span><span class="n">invalid_address</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2"> should be invalid"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>At this point, the tests should be <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.20" data-tralics-id="uid552" id="_uid552" class="codelisting"><div class="heading"><span class="number">Listing 6.20:</span> <span class="description"><span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div><p>The application code for email format validation uses the <code>format</code> validation, which works like this:</p>
<div class="code"><div class="highlight"><pre><span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="sr">/&lt;regular expression&gt;/</span> <span class="p">}</span>
</pre></div></div>
<p>This validates the attribute with the given <em>regular expression</em> (or <em>regex</em>), which is a powerful (and often cryptic) language for matching patterns in strings.<span class="intersentencespace"></span> This means we need to construct a regular expression to match valid email addresses while <em>not</em> matching invalid ones.</p>
<p>There actually exists a full regex for matching email addresses 
according to the official email standard, but it’s enormous, obscure, 
and quite possibly counter-productive.<sup class="footnote" id="_cha-6_footnote-ref-11"><a href="#cha-6_footnote-11">11</a></sup><span class="intersentencespace"></span> In this tutorial, we’ll adopt a more pragmatic regex that has proven to be robust in practice.<span class="intersentencespace"></span> Here’s what it looks like:</p>
<div class="code"><div class="highlight"><pre><span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
</pre></div></div>
<p>To help understand where this comes from, <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#table-valid_email_regex">Table&nbsp;<span class="ref">6.1</span></a> breaks it into bite-sized pieces.<sup class="footnote" id="_cha-6_footnote-ref-12"><a href="#cha-6_footnote-12">12</a></sup></p>
<div data-number="6.1" data-tralics-id="uid555" id="_table-valid_email_regex" class="table"><table class="tabular">
<tbody><tr class="bottom_border"><td class="align_left"><strong>Expression</strong></td>
<td class="align_left"><strong>Meaning</strong></td>
</tr><tr><td class="align_left"><span class="inline_verbatim">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span></td>
<td class="align_left">full regex</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">/</span></td>
<td class="align_left">start of regex</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">\A</span></td>
<td class="align_left">match start of a string</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">[\w+\-.]+</span></td>
<td class="align_left">at least one word character, plus, hyphen, or dot</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">@</span></td>
<td class="align_left">literal “at sign”</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">[a-z\d\-.]+</span></td>
<td class="align_left">at least one letter, digit, hyphen, or dot</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">\.</span></td>
<td class="align_left">literal dot</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">[a-z]+</span></td>
<td class="align_left">at least one letter</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">\z</span></td>
<td class="align_left">match end of a string</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">/</span></td>
<td class="align_left">end of regex</td>
</tr><tr><td class="align_left"><span class="inline_verbatim">i</span></td>
<td class="align_left">case-insensitive</td>
</tr></tbody></table><div class="caption"><span class="header">Table 6.1: </span><span class="description">Breaking down the valid email regex.
</span></div></div>
<p>Although you can learn a lot by studying <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#table-valid_email_regex">Table&nbsp;<span class="ref">6.1</span></a>, to really understand regular expressions I consider using an interactive regular expression matcher like <a target="_blank" href="http://www.rubular.com/">Rubular</a> to be essential (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-rubular">Figure&nbsp;<span class="ref">6.7</span></a>).<sup class="footnote" id="_cha-6_footnote-ref-13"><a href="#cha-6_footnote-13">13</a></sup><span class="intersentencespace"></span>
 The Rubular website has a beautiful interactive interface for making 
regular expressions, along with a handy regex quick reference.<span class="intersentencespace"></span> I encourage you to study <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#table-valid_email_regex">Table&nbsp;<span class="ref">6.1</span></a>
 with a browser window open to Rubular—no amount of reading about 
regular expressions can replace playing with them interactively.<span class="intersentencespace"></span> (<em>Note</em>: If you use the regex from <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#table-valid_email_regex">Table&nbsp;<span class="ref">6.1</span></a> in Rubular, I recommend leaving off the <span class="inline_verbatim">\A</span> and <span class="inline_verbatim">\z</span> characters so that you can match more than one email address at a time in the given test string.)</p>
<div data-number="6.7" data-tralics-id="uid557" id="_fig-rubular" class="center figure">
<div class="graphics image box"><img alt="images/figures/rubular" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/rubular.png"></div><div class="caption"><span class="header">Figure 6.7: </span><span class="description">The awesome <a target="_blank" href="http://www.rubular.com/">Rubular</a> regular expression editor.
</span></div></div>
<p>Applying the regular expression from <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#table-valid_email_regex">Table&nbsp;<span class="ref">6.1</span></a> to the <code>email</code> format validation yields the code in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_format_of_email">Listing&nbsp;<span class="ref">6.21</span></a>.</p>
<div data-number="6.21" data-tralics-id="uid558" id="_code-validates_format_of_email" class="codelisting"><div class="heading"><span class="number">Listing 6.21:</span> 

<span class="description">Validating the email format with a regular expression.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
<span class="hll">  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
</span>  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
<span class="hll">                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">}</span>
</span><span class="k">end</span>
</pre></div></div></div><p>Here the regex <code>VALID_EMAIL_REGEX</code> is a <em>constant</em>, indicated in Ruby by a name starting with a capital letter.<span class="intersentencespace"></span> The code</p>
<div class="code"><div class="highlight"><pre>  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">}</span>
</pre></div></div>
<p>ensures that only email addresses that match the pattern will be considered valid.<span class="intersentencespace"></span> (The expression above has one notable weakness: it allows invalid addresses that contain consecutive dots, such as <code>foo@bar..com</code>.<span class="intersentencespace"></span> Fixing this blemish requires a significantly more complicated regular expression and is left as an exercise (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-modeling_users_exercises">Section&nbsp;<span class="ref">6.5</span></a>).)</p>
<p>At this point, the tests should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.22" data-tralics-id="uid559" id="_uid559" class="codelisting"><div class="heading"><span class="number">Listing 6.22:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test:models
</pre></div></div></div><p>This means that there’s only one constraint left: enforcing email uniqueness.</p>
</div>
<div data-number="6.2.5" class="subsection" data-tralics-id="uid560" id="_sec-uniqueness_validation"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-uniqueness_validation"><span class="number">6.2.5 </span>Uniqueness validation</a></h3>
<p>To enforce uniqueness of email addresses (so that we can use them as usernames), we’ll be using the <code>:unique</code> option to the <code>validates</code> method.<span class="intersentencespace"></span> But be warned: there’s a <em>major</em> caveat, so don’t just skim this section—read it carefully.</p>
<p>We’ll start with some short tests.<span class="intersentencespace"></span> In our previous model tests, we’ve mainly used <code>User.new</code>, which just creates a Ruby object in memory, but for uniqueness tests we actually need to put a record into the database.<sup class="footnote" id="_cha-6_footnote-ref-14"><a href="#cha-6_footnote-14">14</a></sup><span class="intersentencespace"></span> The initial duplicate email test appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email_test">Listing&nbsp;<span class="ref">6.23</span></a>.</p>
<div data-number="6.23" data-tralics-id="uid562" id="_code-validates_uniqueness_of_email_test" class="codelisting"><div class="heading"><span class="number">Listing 6.23:</span> 

<span class="description">A test for the rejection of duplicate email addresses.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="hll">  <span class="nb">test</span> <span class="s2">"email addresses should be unique"</span> <span class="k">do</span>
</span><span class="hll">    <span class="n">duplicate_user</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">dup</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="n">duplicate_user</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div></div><p>The method here is to make a user with the same email address as <code>@user</code> using <code>@user.dup</code>, which creates a duplicate user with the same attributes.<span class="intersentencespace"></span> Since we then save <code>@user</code>, the duplicate user has an email address that already exists in the database, and hence should not be valid.</p>
<p>We can get the new test in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email_test">Listing&nbsp;<span class="ref">6.23</span></a> to pass by adding <code>uniqueness: true</code> to the <code>email</code> validation, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email">Listing&nbsp;<span class="ref">6.24</span></a>.</p>
<div data-number="6.24" data-tralics-id="uid563" id="_code-validates_uniqueness_of_email" class="codelisting"><div class="heading"><span class="number">Listing 6.24:</span> 

<span class="description">Validating the uniqueness of email addresses.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
<span class="hll">                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="kp">true</span>
</span><span class="k">end</span>
</pre></div></div></div><p>We’re not quite done, though.<span class="intersentencespace"></span> Email addresses are typically processed as if they were case-insensitive—i.e., <code>foo@bar.com</code> is treated the same as <code>FOO@BAR.COM</code> or <code>FoO@BAr.coM</code>—so our validation should incorporate this as well.<sup class="footnote" id="_cha-6_footnote-ref-15"><a href="#cha-6_footnote-15">15</a></sup><span class="intersentencespace"></span> It’s thus important to test for case-insensitivity, which we do with the code in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email_case_insensitive_test">Listing&nbsp;<span class="ref">6.25</span></a>.</p>
<div data-number="6.25" data-tralics-id="uid565" id="_code-validates_uniqueness_of_email_case_insensitive_test" class="codelisting"><div class="heading"><span class="number">Listing 6.25:</span> 

<span class="description">Testing case-insensitive email uniqueness.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"email addresses should be unique"</span> <span class="k">do</span>
    <span class="n">duplicate_user</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">dup</span>
<span class="hll">    <span class="n">duplicate_user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">upcase</span>
</span>    <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
    <span class="n">assert_not</span> <span class="n">duplicate_user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>Here we are using the <code>upcase</code> method on strings (seen briefly in <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-blocks">Section&nbsp;<span class="ref">4.3.2</span></a>).<span class="intersentencespace"></span> This test does the same thing as the initial duplicate email test, but with an upper-case email address instead.<span class="intersentencespace"></span> If this test feels a little abstract, go ahead and fire up the console:</p>
<div class="code"><div class="highlight"><pre><span class="go">$ rails console --sandbox</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">upcase</span>
<span class="go">=&gt; "USER@EXAMPLE.COM"</span>
<span class="gp">&gt;&gt; </span><span class="n">duplicate_user</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">dup</span>
<span class="gp">&gt;&gt; </span><span class="n">duplicate_user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">upcase</span>
<span class="gp">&gt;&gt; </span><span class="n">duplicate_user</span><span class="o">.</span><span class="n">valid?</span>
<span class="go">=&gt; true</span>
</pre></div></div>
<p>Of course, <code>duplicate_user.valid?</code> is currently <code>true</code> because the uniqueness validation is case-sensitive, but we want it to be <code>false</code>.<span class="intersentencespace"></span> Fortunately, <code>:uniqueness</code> accepts an option, <code>:case_sensitive</code>, for just this purpose (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email_case_insensitive">Listing&nbsp;<span class="ref">6.26</span></a>).</p>
<div data-number="6.26" data-tralics-id="uid566" id="_code-validates_uniqueness_of_email_case_insensitive" class="codelisting"><div class="heading"><span class="number">Listing 6.26:</span> 

<span class="description">Validating the uniqueness of email addresses, ignoring case.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
<span class="hll">                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
</span><span class="k">end</span>
</pre></div></div></div><p>Note that we have simply replaced <code>true</code> in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email">Listing&nbsp;<span class="ref">6.24</span></a> with <code>case_sensitive: false</code> in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email_case_insensitive">Listing&nbsp;<span class="ref">6.26</span></a>.<span class="intersentencespace"></span> (Rails infers that <code>uniqueness</code> should be <code>true</code> as well.)</p>
<p>At this point, our application—with an important caveat—enforces email uniqueness, and our test suite should pass:</p>
<div data-number="6.27" data-tralics-id="uid567" id="_uid567" class="codelisting"><div class="heading"><span class="number">Listing 6.27:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div><p>There’s just one small problem, which is that <em>the Active Record uniqueness validation does not guarantee uniqueness at the database level</em>.<span class="intersentencespace"></span> Here’s a scenario that explains why:</p>
<ol>
<li>Alice signs up for the sample app, with address alice@wonderland.com.<span class="intersentencespace"></span>
</li>
<li>Alice accidentally clicks on “Submit” <em>twice</em>, sending two requests in quick succession.<span class="intersentencespace"></span>
</li>
<li>The following sequence occurs: request 1 creates a user in memory 
that passes validation, request 2 does the same, request&nbsp;1’s user 
gets saved, request&nbsp;2’s user gets saved.<span class="intersentencespace"></span>
</li>
<li>Result: two user records with the exact same email address, despite the uniqueness validation
</li></ol>
<p>If the above sequence seems implausible, believe me, it isn’t: it can
 happen on any Rails website with significant traffic (which I once 
learned the hard way).<span class="intersentencespace"></span> Luckily, 
the solution is straightforward to implement: we just need to enforce 
uniqueness at the database level as well as at the model level.<span class="intersentencespace"></span> Our method is to create a database <em>index</em> on the email column (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#aside-database_indices">Box&nbsp;<span class="ref">6.2</span></a>), and then require that the index be unique.</p>
<div data-number="6.2" data-tralics-id="uid572" id="_aside-database_indices" class="aside"><div class="heading"><span class="number">Box 6.2.</span> 

<span class="description">Database indices</span></div>
<p>When creating a column in a database, it is important to consider whether we will need to <em>find</em> records by that column.<span class="intersentencespace"></span> Consider, for example, the <span class="tt">email</span> attribute created by the migration in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>.<span class="intersentencespace"></span> When we allow users to log in to the sample app starting in <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>, we will need to find the user record corresponding to the submitted email address.<span class="intersentencespace"></span> Unfortunately, based on the naïve data model, the only way to find a user by email address is to look through <em>each</em> user row in the database and compare its email attribute to the given email—which means we might have to examine <em>every</em> row (since the user could be the last one in the database).<span class="intersentencespace"></span> This is known in the database business as a <em>full-table scan</em>, and for a real site with thousands of users it is a <a target="_blank" href="http://catb.org/jargon/html/B/Bad-Thing.html">Bad Thing</a>.</p>
<p>Putting an index on the email column fixes the problem.<span class="intersentencespace"></span> To understand a database index, it’s helpful to consider the analogy of a book index.<span class="intersentencespace"></span>
 In a book, to find all the occurrences of a given string, say “foobar”,
 you would have to scan each page for “foobar”—the paper version of a 
full-table scan.<span class="intersentencespace"></span> With a book index, on the other hand, you can just look up “foobar” in the index to see all the pages containing “foobar”.<span class="intersentencespace"></span> A database index works essentially the same way.</p>

</div><p>The email index represents an update to our data modeling requirements, which (as discussed in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-database_migrations">Section&nbsp;<span class="ref">6.1.1</span></a>) is handled in Rails using migrations.<span class="intersentencespace"></span> We saw in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-database_migrations">Section&nbsp;<span class="ref">6.1.1</span></a> that generating the User model automatically created a new migration (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>); in the present case, we are adding structure to an existing model, so we need to create a migration directly using the <code>migration</code> generator:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate migration add_index_to_users_email
</pre></div></div>
<p>Unlike the migration for users, the email uniqueness migration is not pre-defined, so we need to fill in its contents with <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_uniqueness_index">Listing&nbsp;<span class="ref">6.28</span></a>.<sup class="footnote" id="_cha-6_footnote-ref-16"><a href="#cha-6_footnote-16">16</a></sup></p>
<div data-number="6.28" data-tralics-id="uid574" id="_code-email_uniqueness_index" class="codelisting"><div class="heading"><span class="number">Listing 6.28:</span> 

<span class="description">The migration for enforcing email uniqueness.<span class="intersentencespace"></span> <span class="break"></span> <span class="filepath">db/migrate/[timestamp]_add_index_to_users_email.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AddIndexToUsersEmail</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
<span class="hll">    <span class="n">add_index</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">unique</span><span class="p">:</span> <span class="kp">true</span>
</span>  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p>This uses a Rails method called <code>add_index</code> to add an index on the <code>email</code> column of the <code>users</code> table.<span class="intersentencespace"></span> The index by itself doesn’t enforce uniqueness, but the option <code>unique: true</code> does.</p>
<p>The final step is to migrate the database:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake db:migrate
</pre></div></div>
<p>(If this fails, try exiting any running sandbox console sessions, which can lock the database and prevent migrations.)</p>
<p>At this point, the test suite should be <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span> due to a violation of the uniqueness constraint in the <em>fixtures</em>, which contain sample data for the test database.<span class="intersentencespace"></span> User fixtures were generated automatically in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a>, and as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-default_fixtures">Listing&nbsp;<span class="ref">6.29</span></a> the email addresses are not unique.<span class="intersentencespace"></span> (They’re not <em>valid</em> either, but fixture data doesn’t get run through the validations.)</p>
<div data-number="6.29" data-tralics-id="uid575" id="_code-default_fixtures" class="codelisting"><div class="heading"><span class="number">Listing 6.29:</span> 

<span class="description">The default user fixtures.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/fixtures/users.yml</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="c1"># Read about fixtures at http://api.rubyonrails.org/classes/ActiveRecord/</span>
<span class="c1"># FixtureSet.html</span>

<span class="l-Scalar-Plain">one</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">MyString</span>
  <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">MyString</span>

<span class="l-Scalar-Plain">two</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">MyString</span>
  <span class="l-Scalar-Plain">email</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">MyString</span>
</pre></div></div></div><p>Because we won’t need fixtures until <a class="hyperref" href="https://www.railstutorial.org/book/log_in_log_out#cha-log_in_log_out">Chapter&nbsp;<span class="ref">8</span></a>, for now we’ll just remove them, leaving an empty fixtures file (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-empty_fixtures">Listing&nbsp;<span class="ref">6.30</span></a>).</p>
<div data-number="6.30" data-tralics-id="uid576" id="_code-empty_fixtures" class="codelisting"><div class="heading"><span class="number">Listing 6.30:</span> 

<span class="description">An empty fixtures file.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/fixtures/users.yml</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="c1"># empty</span>
</pre></div></div></div><p>Having addressed the uniqueness caveat, there’s one more change we need to make to be assured of email uniqueness.<span class="intersentencespace"></span>
 Some database adapters use case-sensitive indices, considering the 
strings “Foo@ExAMPle.CoM” and “foo@example.com” to be distinct, but our 
application treats those addresses as the same.<span class="intersentencespace"></span>
 To avoid this incompatibility, we’ll standardize on all lower-case 
addresses, converting “Foo@ExAMPle.CoM” to “foo@example.com” before 
saving it to the database.<span class="intersentencespace"></span> The way to do this is with a <a target="_blank" href="http://en.wikipedia.org/wiki/Callback_%28computer_science%29"><em>callback</em></a>, which is a method that gets invoked at a particular point in the lifecycle of an Active Record object.<span class="intersentencespace"></span> In the present case, that point is before the object is saved, so we’ll use a <code>before_save</code> callback to downcase the email attribute before saving the user.<sup class="footnote" id="_cha-6_footnote-ref-17"><a href="#cha-6_footnote-17">17</a></sup><span class="intersentencespace"></span> The result appears in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase">Listing&nbsp;<span class="ref">6.31</span></a>.<span class="intersentencespace"></span> (This is just a first implementation; we’ll discuss this subject again in <a class="hyperref" href="https://www.railstutorial.org/book/account_activation_password_reset#sec-account_activations_resource">Section&nbsp;<span class="ref">10.1.1</span></a>, where we’ll use the preferred <em>method reference</em> convention for defining callbacks.)</p>
<div data-number="6.31" data-tralics-id="uid578" id="_code-email_downcase" class="codelisting"><div class="heading"><span class="number">Listing 6.31:</span> 

<span class="description">Ensuring email uniqueness by downcasing the email attribute.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">  <span class="n">before_save</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
</span>  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span>  <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div><p>The code in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase">Listing&nbsp;<span class="ref">6.31</span></a> passes a block to the <code>before_save</code> callback and sets the user’s email address to a lower-case version of its current value using the <code>downcase</code> string method.<span class="intersentencespace"></span> (Writing a test for email downcasing is left as an exercise (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-modeling_users_exercises">Section&nbsp;<span class="ref">6.5</span></a>).)</p>
<p>In <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase">Listing&nbsp;<span class="ref">6.31</span></a>, we could have written the assignment as</p>
<div class="code"><div class="highlight"><pre><span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">downcase</span>
</pre></div></div>
<p>(where <code>self</code> refers to the current user), but inside the User model the <code>self</code> keyword is optional on the right-hand side:</p>
<div class="code"><div class="highlight"><pre><span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span>
</pre></div></div>
<p>We encountered this idea briefly in the context of <code>reverse</code> in the <code>palindrome</code> method (<a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-a_class_of_our_own">Section&nbsp;<span class="ref">4.4.2</span></a>), which also noted that <code>self</code> is <em>not</em> optional in an assignment, so</p>
<div class="code"><div class="highlight"><pre><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span>
</pre></div></div>
<p>wouldn’t work.<span class="intersentencespace"></span> (We’ll discuss this subject in more depth in <a class="hyperref" href="https://www.railstutorial.org/book/log_in_log_out#sec-remember_me">Section&nbsp;<span class="ref">8.4</span></a>.)</p>
<p>At this point, the Alice scenario above will work fine: the database 
will save a user record based on the first request, and it will reject 
the second save for violating the uniqueness constraint.<span class="intersentencespace"></span> (An error will appear in the Rails log, but that doesn’t do any harm.)<span class="intersentencespace"></span> Moreover, adding this index on the email attribute accomplishes a second goal, alluded to briefly in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-finding_user_objects">Section&nbsp;<span class="ref">6.1.4</span></a>: as noted in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#aside-database_indices">Box&nbsp;<span class="ref">6.2</span></a>, the index on the <code>email</code> attribute fixes a potential efficiency problem by preventing a full-table scan when finding users by email address.</p>
</div></div><div data-number="6.3" class="section" data-tralics-id="cid40" id="_sec-adding_a_secure_password"><h2><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-adding_a_secure_password"><span class="number">6.3 </span>Adding a secure password</a></h2>
<p>Now that we’ve defined validations for the name and email fields, 
we’re ready to add the last of the basic User attributes: a secure 
password.<span class="intersentencespace"></span> The method is to require each user to have a password (with a password confirmation), and then store a <em>hashed</em> version of the password in the database.<span class="intersentencespace"></span> (There is some potential for confusion here.<span class="intersentencespace"></span> In the present context, a <em>hash</em> refers not to the Ruby data structure from <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-hashes_and_symbols">Section&nbsp;<span class="ref">4.3.3</span></a> but rather to the result of applying an irreversible <a target="_blank" href="http://en.wikipedia.org/wiki/Hash_function">hash function</a> to input data.)<span class="intersentencespace"></span> We’ll also add a way to <em>authenticate</em> a user based on a given password, a method we’ll use in <a class="hyperref" href="https://www.railstutorial.org/book/log_in_log_out#cha-log_in_log_out">Chapter&nbsp;<span class="ref">8</span></a> to allow users to log in to the site.</p>
<p>The method for authenticating users will be to take a submitted 
password, hash it, and compare the result to the hashed value stored in 
the database.<span class="intersentencespace"></span> If the two match, then the submitted password is correct and the user is authenticated.<span class="intersentencespace"></span>
 By comparing hashed values instead of raw passwords, we will be able to
 authenticate users without storing the passwords themselves.<span class="intersentencespace"></span> This means that, even if our database is compromised, our users’ passwords will still be secure.</p>
<div data-number="6.3.1" class="subsection" data-tralics-id="uid579" id="_sec-a_hashed_password"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-a_hashed_password"><span class="number">6.3.1 </span>A hashed password</a></h3>
<p>Most of the secure password machinery will be implemented using a single Rails method called <code>has_secure_password</code>, which we’ll include in the User model as follows:</p>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">has_secure_password</span>
<span class="k">end</span>
</pre></div></div>
<p>When included in a model as above, this one method adds the following functionality:</p>
<ul>
<li>The ability to save a securely hashed <code>password_digest</code> attribute to the database
</li>
<li>A pair of virtual attributes<sup class="footnote" id="_cha-6_footnote-ref-18"><a href="#cha-6_footnote-18">18</a></sup> (<code>password</code> and <code>password_confirmation</code>), including presence validations upon object creation and a validation requiring that they match
</li>
<li>An <code>authenticate</code> method that returns the user when the password is correct (and <code>false</code> otherwise)
</li></ul>
<p>The only requirement for <code>has_secure_password</code> to work its magic is for the corresponding model to have an attribute called <code>password_digest</code>.<span class="intersentencespace"></span> (The name <em>digest</em> comes from the terminology of <a target="_blank" href="http://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic hash functions</a>.<span class="intersentencespace"></span> In this context, <em>hashed password</em> and <em>password digest</em> are synonyms.)<sup class="footnote" id="_cha-6_footnote-ref-19"><a href="#cha-6_footnote-19">19</a></sup> In the case of the User model, this leads to the data model shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_password_digest">Figure&nbsp;<span class="ref">6.8</span></a>.</p>
<div data-number="6.8" data-tralics-id="uid585" id="_fig-user_model_password_digest" class="center figure"><span class="graphics"><img alt="user_model_password_digest_3rd_edition" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/user_model_password_digest_3rd_edition.png"></span>
<div class="caption"><span class="header">Figure 6.8: </span><span class="description">The User data model with an added <code>password_digest</code> attribute.
</span></div></div>
<p>To implement the data model in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_password_digest">Figure&nbsp;<span class="ref">6.8</span></a> , we first generate an appropriate migration for the <code>password_digest</code> column.<span class="intersentencespace"></span> We can choose any migration name we want, but it’s convenient to end the name with <code>to_users</code>, since in this case Rails automatically constructs a migration to add columns to the <code>users</code> table.<span class="intersentencespace"></span> The result, with migration name <code>add_password_digest_to_users</code>, appears as follows:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate migration add_password_digest_to_users password_digest:string
</pre></div></div>
<p>Here we’ve also supplied the argument <code>password_digest:string</code> with the name and type of attribute we want to create.<span class="intersentencespace"></span> (Compare this to the original generation of the <code>users</code> table in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-generate_user_model">Listing&nbsp;<span class="ref">6.1</span></a>, which included the arguments <code>name:string</code> and <code>email:string</code>.)<span class="intersentencespace"></span> By including <code>password_digest:string</code>, we’ve given Rails enough information to construct the entire migration for us, as seen in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-password_migration">Listing&nbsp;<span class="ref">6.32</span></a>.</p>
<div data-number="6.32" data-tralics-id="uid586" id="_code-password_migration" class="codelisting"><div class="heading"><span class="number">Listing 6.32:</span> 

<span class="description">The migration to add a <code>password_digest</code> column to the <code>users</code> table.<span class="intersentencespace"></span> <span class="break"></span> <span class="filepath">db/migrate/[timestamp]_add_password_digest_to_users.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">AddPasswordDigestToUsers</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
  <span class="k">def</span> <span class="nf">change</span>
    <span class="n">add_column</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">:password_digest</span><span class="p">,</span> <span class="ss">:string</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><p><a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-password_migration">Listing&nbsp;<span class="ref">6.32</span></a> uses the <code>add_column</code> method to add a <code>password_digest</code> column to the <code>users</code> table.<span class="intersentencespace"></span> To apply it, we just migrate the database:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake db:migrate
</pre></div></div>
<p>To make the password digest, <code>has_secure_password</code> uses a state-of-the-art hash function called <a target="_blank" href="http://en.wikipedia.org/wiki/Bcrypt">bcrypt</a>.<span class="intersentencespace"></span>
 By hashing the password with bcrypt, we ensure that an attacker won’t 
be able to log in to the site even if they manage to obtain a copy of 
the database.<span class="intersentencespace"></span> To use bcrypt in the sample application, we need to add the <code>bcrypt</code> gem to our <code>Gemfile</code> (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-bcrypt_ruby">Listing&nbsp;<span class="ref">6.33</span></a>).</p>
<div data-number="6.33" data-tralics-id="uid587" id="_code-bcrypt_ruby" class="codelisting"><div class="heading"><span class="number">Listing 6.33:</span> 

<span class="description">Adding <code>bcrypt</code> to the <code>Gemfile</code>.</span>
</div>

<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'rails'</span><span class="p">,</span>                <span class="s1">'4.2.2'</span>
<span class="n">gem</span> <span class="s1">'bcrypt'</span><span class="p">,</span>               <span class="s1">'3.1.7'</span>
<span class="o">.</span>
<span class="o">.</span>
<span class="o">.</span>
</pre></div></div></div><p>Then run <code>bundle install</code> as usual:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div></div>
</div>
<div data-number="6.3.2" class="subsection" data-tralics-id="uid588" id="_sec-has_secure_password"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-has_secure_password"><span class="number">6.3.2 </span>User has secure password</a></h3>
<p>Now that we’ve supplied the User model with the required <code>password_digest</code> attribute and installed bcrypt, we’re ready to add <code>has_secure_password</code> to the User model, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-has_secure_password">Listing&nbsp;<span class="ref">6.34</span></a>.</p>
<div data-number="6.34" data-tralics-id="uid589" id="_code-has_secure_password" class="codelisting"><div class="heading"><span class="number">Listing 6.34:</span> 

<span class="description">Adding <code>has_secure_password</code> to the User model.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_save</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
<span class="hll">  <span class="n">has_secure_password</span>
</span><span class="k">end</span>
</pre></div></div></div><p>As indicated by the <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span> indicator in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-has_secure_password">Listing&nbsp;<span class="ref">6.34</span></a>, the tests are now failing, as you can confirm at the command line:</p>
<div data-number="6.35" data-tralics-id="uid590" id="_uid590" class="codelisting"><div class="heading"><span class="number">Listing 6.35:</span> <span class="description"><span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div><p>The reason is that, as noted in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-a_hashed_password">Section&nbsp;<span class="ref">6.3.1</span></a>, <code>has_secure_password</code> enforces validations on the virtual <code>password</code> and <code>password_confirmation</code> attributes, but the tests in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_uniqueness_of_email_case_insensitive_test">Listing&nbsp;<span class="ref">6.25</span></a> create an <code>@user</code> variable without these attributes:</p>
<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">setup</span>
  <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">)</span>
<span class="k">end</span>
</pre></div></div>
<p>So, to get the test suite passing again, we just need to add a password and its confirmation, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-test_with_password_confirmation">Listing&nbsp;<span class="ref">6.36</span></a>.</p>
<div data-number="6.36" data-tralics-id="uid591" id="_code-test_with_password_confirmation" class="codelisting"><div class="heading"><span class="number">Listing 6.36:</span> 

<span class="description">Adding a password and its confirmation.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">,</span>
<span class="hll">                     <span class="ss">password</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">)</span>
</span>  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div></div></div><p>Now the tests should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.37" data-tralics-id="uid592" id="_uid592" class="codelisting"><div class="heading"><span class="number">Listing 6.37:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test
</pre></div></div></div><p>We’ll see in just a moment the benefits of adding <code>has_secure_password</code> to the User model (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_and_authenticating_a_user">Section&nbsp;<span class="ref">6.3.4</span></a>), but first we’ll add a minimal requirement on password security.</p>
</div>
<div data-number="6.3.3" class="subsection" data-tralics-id="uid593" id="_sec-minimum_password_standards"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-minimum_password_standards"><span class="number">6.3.3 </span>Minimum password standards</a></h3>
<p>It’s good practice in general to enforce some minimum standards on passwords to make them harder to guess.<span class="intersentencespace"></span> There are many options for <a target="_blank" href="http://lmgtfy.com/?q=rails+enforce+password+strength">enforcing password strength in Rails</a>, but for simplicity we’ll just enforce a minimum length and the requirement that the password not be blank.<span class="intersentencespace"></span> Picking a length of 6 as a reasonable minimum leads to the validation test shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-minimum_password_length_test">Listing&nbsp;<span class="ref">6.38</span></a>.</p>
<div data-number="6.38" data-tralics-id="uid594" id="_code-minimum_password_length_test" class="codelisting"><div class="heading"><span class="number">Listing 6.38:</span> 

<span class="description">Testing for a minimum password length.<span class="intersentencespace"></span> <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">,</span>
                     <span class="ss">password</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="hll">  <span class="nb">test</span> <span class="s2">"password should be present (nonblank)"</span> <span class="k">do</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">" "</span> <span class="o">*</span> <span class="mi">6</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span>
<span class="hll">  <span class="nb">test</span> <span class="s2">"password should have a minimum length"</span> <span class="k">do</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">5</span>
</span><span class="hll">    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
</span><span class="hll">  <span class="k">end</span>
</span><span class="k">end</span>
</pre></div></div></div><p>Note the use of the compact multiple assignment</p>
<div class="code"><div class="highlight"><pre><span class="vi">@user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">5</span>
</pre></div></div>
<p>in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-minimum_password_length_test">Listing&nbsp;<span class="ref">6.38</span></a>.<span class="intersentencespace"></span>
 This arranges to assign a particular value to the password and its 
confirmation at the same time (in this case, a string of length&nbsp;5, 
constructed using string multiplication as in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-length_validation_test">Listing&nbsp;<span class="ref">6.14</span></a>).</p>
<p>You may be able to guess the code for enforcing a <code>minimum</code> length constraint by referring to the corresponding <code>maximum</code> validation for the user’s name (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-length_validation">Listing&nbsp;<span class="ref">6.16</span></a>):</p>
<div class="code"><div class="highlight"><pre><span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}</span>
</pre></div></div>
<p>Combining this with a <code>presence</code> validation (<a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-presence_validation">Section&nbsp;<span class="ref">6.2.2</span></a>) to prevent nonblank passwords, this leads to the User model shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-password_implementation">Listing&nbsp;<span class="ref">6.39</span></a>.<span class="intersentencespace"></span> (It turns out the <code>has_secure_password</code> method includes a presence validation, but unfortunately it only applies to records with <em>empty</em> passwords, which allows users to create invalid passwords like <code>’ ’</code> (six spaces).)</p>
<div data-number="6.39" data-tralics-id="uid595" id="_code-password_implementation" class="codelisting"><div class="heading"><span class="number">Listing 6.39:</span> 

<span class="description">The complete implementation for secure passwords.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_save</span> <span class="p">{</span> <span class="nb">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
  <span class="n">has_secure_password</span>
<span class="hll">  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}</span>
</span><span class="k">end</span>
</pre></div></div></div><p>At this point, the tests should be <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>:</p>
<div data-number="6.40" data-tralics-id="uid596" id="_uid596" class="codelisting"><div class="heading"><span class="number">Listing 6.40:</span> <span class="description"><span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span></span>
</div>

<div class="code"><div class="highlight"><pre>$ bundle exec rake test:models
</pre></div></div></div></div>
<div data-number="6.3.4" class="subsection" data-tralics-id="uid597" id="_sec-creating_and_authenticating_a_user"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_and_authenticating_a_user"><span class="number">6.3.4 </span>Creating and authenticating a user</a></h3>
<p>Now that the basic User model is complete, we’ll create a user in the
 database as preparation for making a page to show the user’s 
information in <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#sec-showing_users">Section&nbsp;<span class="ref">7.1</span></a>.<span class="intersentencespace"></span> We’ll also take a more concrete look at the effects of adding <code>has_secure_password</code> to the User model, including an examination of the important <code>authenticate</code> method.</p>
<p>Since users can’t yet sign up for the sample application through the web—that’s the goal of <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>—we’ll use the Rails console to create a new user by hand.<span class="intersentencespace"></span> For convenience, we’ll use the <code>create</code> method discussed in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-creating_user_objects">Section&nbsp;<span class="ref">6.1.3</span></a>, but in the present case we’ll take care <em>not</em> to start in a sandbox so that the resulting user will be saved to the database.<span class="intersentencespace"></span> This means starting an ordinary <code>rails console</code> session and then creating a user with a valid name and email address together with a valid password and matching confirmation:</p>
<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Michael Hartl"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"mhartl@example.com"</span><span class="p">,</span>
<span class="gp">?&gt; </span>            <span class="ss">password</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-09-11 14:26:42", updated_at: "2014-09-11 14:26:42",</span>
<span class="go">password_digest: "$2a$10$sLcMI2f8VglgirzjSJOln.Fv9NdLMbqmR4rdTWIXY1G..."&gt;</span>
</pre></div></div>
<p>To check that this worked, let’s look at the resulting <code>users</code> table in the development database using DB Browser for SQLite, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-sqlite_user_row">Figure&nbsp;<span class="ref">6.9</span></a>.<sup class="footnote intersentence" id="_cha-6_footnote-ref-20"><a href="#cha-6_footnote-20">20</a></sup><span class="intersentencespace"></span> (If you’re using the cloud IDE, you should download the database file as in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-sqlite_download">Figure&nbsp;<span class="ref">6.5</span></a>.)<span class="intersentencespace"></span> Note that the columns correspond to the attributes of the data model defined in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#fig-user_model_password_digest">Figure&nbsp;<span class="ref">6.8</span></a>.</p>
<div data-number="6.9" data-tralics-id="uid603" id="_fig-sqlite_user_row" class="center figure">
<div class="graphics image"><img alt="images/figures/sqlite_user_row_with_password_3rd_edition" src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/sqlite_user_row_with_password_3rd_edition.png"></div><div class="caption"><span class="header">Figure 6.9: </span><span class="description">A user row in the SQLite database <code>db/development.sqlite3</code>.
</span></div></div>
<p>Returning to the console, we can see the effect of <code>has_secure_password</code> from <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-password_implementation">Listing&nbsp;<span class="ref">6.39</span></a> by looking at the <code>password_digest</code> attribute:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">email</span><span class="p">:</span> <span class="s2">"mhartl@example.com"</span><span class="p">)</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">password_digest</span>
<span class="go">=&gt; "$2a$10$YmQTuuDNOszvu5yi7auOC.F4G//FGhyQSWCpghqRWQWITUYlG3XVy"</span>
</pre></div></div>
<p>This is the hashed version of the password (<code>"foobar"</code>) used to initialize the user object.<span class="intersentencespace"></span> Because it’s constructed using bcrypt, it is computationally impractical to use the digest to discover the original password.<sup class="footnote" id="_cha-6_footnote-ref-21"><a href="#cha-6_footnote-21">21</a></sup></p>
<p>As noted in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-a_hashed_password">Section&nbsp;<span class="ref">6.3.1</span></a>, <code>has_secure_password</code> automatically adds an <code>authenticate</code> method to the corresponding model objects.<span class="intersentencespace"></span> This method determines if a given password is valid for a particular user by computing its digest and comparing the result to <code>password_digest</code> in the database.<span class="intersentencespace"></span> In the case of the user we just created, we can try a couple of invalid passwords as follows:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">"not_the_right_password"</span><span class="p">)</span>
<span class="go">false</span>
<span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">"foobaz"</span><span class="p">)</span>
<span class="go">false</span>
</pre></div></div>
<p>Here <code>user.authenticate</code> returns <code>false</code> for invalid password.<span class="intersentencespace"></span> If we instead authenticate with the correct password, <code>authenticate</code> returns the user itself:</p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">"foobar"</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "mhartl@example.com",</span>
<span class="go">created_at: "2014-07-25 02:58:28", updated_at: "2014-07-25 02:58:28",</span>
<span class="go">password_digest: "$2a$10$YmQTuuDNOszvu5yi7auOC.F4G//FGhyQSWCpghqRWQW..."&gt;</span>
</pre></div></div>
<p>In <a class="hyperref" href="https://www.railstutorial.org/book/log_in_log_out#cha-log_in_log_out">Chapter&nbsp;<span class="ref">8</span></a>, we’ll use the <code>authenticate</code> method to sign registered users into our site.<span class="intersentencespace"></span> In fact, it will turn out not to be important that <code>authenticate</code> returns the user itself; all that will matter is that it returns a value that is <code>true</code> in a boolean context.<span class="intersentencespace"></span> Since a user object is neither <code>nil</code> nor <code>false</code>, it does the job nicely:<sup class="footnote" id="_cha-6_footnote-ref-22"><a href="#cha-6_footnote-22">22</a></sup></p>
<div class="code"><div class="highlight"><pre><span class="gp">&gt;&gt; </span><span class="o">!!</span><span class="n">user</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s2">"foobar"</span><span class="p">)</span>
<span class="go">=&gt; true</span>
</pre></div></div>
</div></div><div data-number="6.4" class="section" data-tralics-id="cid41" id="_sec-modeling_users_conclusion"><h2><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-modeling_users_conclusion"><span class="number">6.4 </span>Conclusion</a></h2>
<p>Starting from scratch, in this chapter we created a working User 
model with name, email, and password attributes, together with 
validations enforcing several important constraints on their values.<span class="intersentencespace"></span> In addition, we have the ability to securely authenticate users using a given password.<span class="intersentencespace"></span> This is a remarkable amount of functionality for only twelve lines of code.</p>
<p>In the next chapter, <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>, we’ll make a working signup form to create new users, together with a page to display each user’s information.<span class="intersentencespace"></span> In <a class="hyperref" href="https://www.railstutorial.org/book/log_in_log_out#cha-log_in_log_out">Chapter&nbsp;<span class="ref">8</span></a>, we’ll then use the authentication machinery from <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-adding_a_secure_password">Section&nbsp;<span class="ref">6.3</span></a> to let users log into the site.</p>
<p>If you’re using Git, now would be a good time to commit if you haven’t done so in a while:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake test
$ git add -A
$ git commit -m "Make a basic User model (including secure passwords)"
</pre></div></div>
<p>Then merge back into the master branch and push to the remote repository:</p>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge modeling-users
<span class="gp">$</span> git push
</pre></div></div>
<p>To get the User model working in production, we need to run the migrations at Heroku, which we can do with <code>heroku run</code>:</p>
<div class="code"><div class="highlight"><pre>$ bundle exec rake test
$ git push heroku
$ heroku run rake db:migrate
</pre></div></div>
<p>We can verify that this worked by running a console in production:</p>
<div class="code"><div class="highlight"><pre><span class="go">$ heroku run console --sandbox</span>
<span class="gp">&gt;&gt; </span><span class="no">User</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Michael Hartl"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"michael@example.com"</span><span class="p">,</span>
<span class="gp">?&gt; </span>            <span class="ss">password</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">)</span>
<span class="go">=&gt; #&lt;User id: 1, name: "Michael Hartl", email: "michael@example.com",</span>
<span class="go">created_at: "2014-08-29 03:27:50", updated_at: "2014-08-29 03:27:50",</span>
<span class="go">password_digest: "$2a$10$IViF0Q5j3hsEVgHgrrKH3uDou86Ka2lEPz8zkwQopwj..."&gt;</span>
</pre></div></div>
<div data-number="6.4.1" class="subsection" data-tralics-id="uid606" id="_sec-modeling_users_what_we_learned_in_this_chapter"><h3><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-modeling_users_what_we_learned_in_this_chapter"><span class="number">6.4.1 </span>What we learned in this chapter</a></h3>
<ul>
<li>Migrations allow us to modify our application’s data model.<span class="intersentencespace"></span>
</li>
<li>Active Record comes with a large number of methods for creating and manipulating data models.<span class="intersentencespace"></span>
</li>
<li>Active Record validations allow us to place constraints on the data in our models.<span class="intersentencespace"></span>
</li>
<li>Common validations include presence, length, and format.<span class="intersentencespace"></span>
</li>
<li>Regular expressions are cryptic but powerful.<span class="intersentencespace"></span>
</li>
<li>Defining a database index improves lookup efficiency while allowing enforcement of uniqueness at the database level.<span class="intersentencespace"></span>
</li>
<li>We can add a secure password to a model using the built-in <code>has_secure_password</code> method.<span class="intersentencespace"></span>
</li></ul>
</div></div><div data-number="6.5" class="section" data-tralics-id="cid42" id="_sec-modeling_users_exercises"><h2><a class="heading hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-modeling_users_exercises"><span class="number">6.5 </span>Exercises</a></h2>
<p><em>Note</em>: The <em>Solutions Manual for Exercises</em>, with solutions to every exercise in the <em>Ruby on Rails Tutorial</em> book, is included for free with every purchase at <a target="_blank" href="http://www.railstutorial.org/">www.railstutorial.org</a>.</p>
<p>For a suggestion on how to avoid conflicts between exercises and the main tutorial, see the note on exercise topic branches in <a class="hyperref" href="https://www.railstutorial.org/book/static_pages#sec-static_pages_exercises">Section&nbsp;<span class="ref">3.6</span></a>.</p>
<ol>
<li>Add a test for the email downcasing from <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase">Listing&nbsp;<span class="ref">6.31</span></a>, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase_test">Listing&nbsp;<span class="ref">6.41</span></a>.<span class="intersentencespace"></span> This test uses the <code>reload</code> method for reloading a value from the database and the <code>assert_equal</code> method for testing equality.<span class="intersentencespace"></span> To verify that <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase_test">Listing&nbsp;<span class="ref">6.41</span></a> tests the right thing, comment out the <code>before_save</code> line to get to <span style="color: red"><span class="sc"></span><span class="sc"><strong>red</strong></span><span class="sc"></span></span>, then uncomment it to get to <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span>.
</li>
<li>By running the test suite, verify that the <code>before_save</code> callback can be written using the “bang” method <code>email.downcase!</code> to modify the <code>email</code> attribute directly, as shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-downcase_bang">Listing&nbsp;<span class="ref">6.42</span></a>.
</li>
<li>As noted in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#sec-format_validation">Section&nbsp;<span class="ref">6.2.4</span></a>, the email regex in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-validates_format_of_email">Listing&nbsp;<span class="ref">6.21</span></a> allows invalid email addresses with consecutive dots in the domain name, i.e., addresses of the form <em>foo@bar..com</em>.<span class="intersentencespace"></span> Add this address to the list of invalid addresses in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_format_validation_tests">Listing&nbsp;<span class="ref">6.19</span></a> to get a failing test, and then use the more complicated regex shown in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-better_email_regex">Listing&nbsp;<span class="ref">6.43</span></a> to get the test to pass.
</li></ol>
<div data-number="6.41" data-tralics-id="uid617" id="_code-email_downcase_test" class="codelisting"><div class="heading"><span class="number">Listing 6.41:</span> 

<span class="description">A test for the email downcasing from <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-email_downcase">Listing&nbsp;<span class="ref">6.31</span></a>.<span class="intersentencespace"></span> <span class="break"></span> <span class="filepath">test/models/user_test.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">'test_helper'</span>

<span class="k">class</span> <span class="nc">UserTest</span> <span class="o">&lt;</span> <span class="no">ActiveSupport</span><span class="o">::</span><span class="no">TestCase</span>

  <span class="k">def</span> <span class="nf">setup</span>
    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="nb">name</span><span class="p">:</span> <span class="s2">"Example User"</span><span class="p">,</span> <span class="ss">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">,</span>
                     <span class="ss">password</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">,</span> <span class="ss">password_confirmation</span><span class="p">:</span> <span class="s2">"foobar"</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="nb">test</span> <span class="s2">"email addresses should be unique"</span> <span class="k">do</span>
    <span class="n">duplicate_user</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">dup</span>
    <span class="n">duplicate_user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">upcase</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
    <span class="n">assert_not</span> <span class="n">duplicate_user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>

<span class="hll">  <span class="nb">test</span> <span class="s2">"email addresses should be saved as lower-case"</span> <span class="k">do</span>
</span><span class="hll">    <span class="n">mixed_case_email</span> <span class="o">=</span> <span class="s2">"Foo@ExAMPle.CoM"</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">mixed_case_email</span>
</span><span class="hll">    <span class="vi">@user</span><span class="o">.</span><span class="n">save</span>
</span><span class="hll">    <span class="n">assert_equal</span> <span class="n">mixed_case_email</span><span class="o">.</span><span class="n">downcase</span><span class="p">,</span> <span class="vi">@user</span><span class="o">.</span><span class="n">reload</span><span class="o">.</span><span class="n">email</span>
</span><span class="hll">  <span class="k">end</span>
</span>
  <span class="nb">test</span> <span class="s2">"password should have a minimum length"</span> <span class="k">do</span>
    <span class="vi">@user</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="vi">@user</span><span class="o">.</span><span class="n">password_confirmation</span> <span class="o">=</span> <span class="s2">"a"</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="n">assert_not</span> <span class="vi">@user</span><span class="o">.</span><span class="n">valid?</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div></div></div><div data-number="6.42" data-tralics-id="uid618" id="_code-downcase_bang" class="codelisting"><div class="heading"><span class="number">Listing 6.42:</span> 

<span class="description">An alternate implementation of the <code>before_save</code> callback.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="hll">  <span class="n">before_save</span> <span class="p">{</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase!</span> <span class="p">}</span>
</span>  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i</span>
  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">255</span> <span class="p">},</span>
                    <span class="nb">format</span><span class="p">:</span> <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
  <span class="n">has_secure_password</span>
  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div><div data-number="6.43" data-tralics-id="uid619" id="_code-better_email_regex" class="codelisting"><div class="heading"><span class="number">Listing 6.43:</span> 

<span class="description">Disallowing double dots in email domain names.<span class="intersentencespace"></span> <span style="color: ForestGreen"><span class="sc"></span><span class="sc"><strong>green</strong></span><span class="sc"></span></span><span class="break"></span> <span class="filepath">app/models/user.rb</span></span>
</div>

<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">before_save</span> <span class="p">{</span> <span class="n">email</span><span class="o">.</span><span class="n">downcase!</span> <span class="p">}</span>
  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">maximum</span><span class="p">:</span> <span class="mi">50</span> <span class="p">}</span>
<span class="hll">  <span class="no">VALID_EMAIL_REGEX</span> <span class="o">=</span> <span class="sr">/\A[\w+\-.]+@[a-z\d\-]+(\.[a-z\d\-]+)*\.[a-z]+\z/i</span>
</span>  <span class="n">validates</span> <span class="ss">:email</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span>   <span class="kp">true</span><span class="p">,</span>
                    <span class="nb">format</span><span class="p">:</span>     <span class="p">{</span> <span class="ss">with</span><span class="p">:</span> <span class="no">VALID_EMAIL_REGEX</span> <span class="p">},</span>
                    <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span> <span class="p">}</span>
  <span class="n">has_secure_password</span>
  <span class="n">validates</span> <span class="ss">:password</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">length</span><span class="p">:</span> <span class="p">{</span> <span class="ss">minimum</span><span class="p">:</span> <span class="mi">6</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div></div></div></div><div id="cha-6_footnotes">
  <ol class="footnotes">
    <li id="_cha-6_footnote-1">The name comes from the “<a target="_blank" href="http://en.wikipedia.org/wiki/Active_record_pattern">active record pattern</a>”, identified and named in <em>Patterns of Enterprise Application Architecture</em> by Martin Fowler.&nbsp;<a href="#cha-6_footnote-ref-1" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-2">Pronounced “ess-cue-ell”, though the alternate pronunciation “sequel” is also common.&nbsp;<a href="#cha-6_footnote-ref-2" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-3">By using an email address as the username, we open the possibility of communicating with our users at a future date (<a class="hyperref" href="https://www.railstutorial.org/book/account_activation_password_reset#cha-account_activation_and_password_reset">Chapter&nbsp;<span class="ref">10</span></a>).&nbsp;<a href="#cha-6_footnote-ref-3" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-4">Don’t worry about exactly how the <code>t</code>&nbsp;object manages to do this; the beauty of <em>abstraction layers</em> is that we don’t have to know.<span class="intersentencespace"></span> We can just trust the <code>t</code>&nbsp;object to do its job.&nbsp;<a href="#cha-6_footnote-ref-4" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-5">Officially pronounced “ess-cue-ell-ite”, although the (mis)pronunciation “sequel-ite” is also common.&nbsp;<a href="#cha-6_footnote-ref-5" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-6">The only exception is in <a class="hyperref" href="https://www.railstutorial.org/book/following_users#sec-scopes_subselects_and_a_lambda">Section&nbsp;<span class="ref">12.3.3</span></a>.&nbsp;<a href="#cha-6_footnote-ref-6" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-7">In case you’re curious about <code>"2014-07-24 00:57:46"</code>, I’m not writing this after midnight; the timestamps are recorded in <a target="_blank" href="http://en.wikipedia.org/wiki/Coordinated_Universal_Time">Coordinated Universal Time</a> (UTC), which for most practical purposes is the same as <a target="_blank" href="http://en.wikipedia.org/wiki/Greenwich_Mean_Time">Greenwich Mean Time</a>.<span class="intersentencespace"></span> From the <a target="_blank" href="http://tf.nist.gov/general/misc.htm">NIST Time and Frequency FAQ</a>: <strong>Q:</strong> Why is UTC used as the acronym for Coordinated Universal Time instead of CUT? <strong>A:</strong>
 In 1970 the Coordinated Universal Time system was devised by an 
international advisory group of technical experts within the 
International Telecommunication Union (ITU).<span class="intersentencespace"></span> The ITU felt it was best to designate a single abbreviation for use in all languages in order to minimize confusion.<span class="intersentencespace"></span>
 Since unanimous agreement could not be achieved on using either the 
English word order, CUT, or the French word order, TUC, the acronym UTC 
was chosen as a compromise.&nbsp;<a href="#cha-6_footnote-ref-7" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-8">Exceptions and exception handling are somewhat advanced Ruby subjects, and we won’t need them much in this book.<span class="intersentencespace"></span> They are important, though, and I suggest learning about them using one of the Ruby books recommended in <a class="hyperref" href="https://www.railstutorial.org/book/following_users#sec-guide_to_further_resources">Section&nbsp;<span class="ref">12.4.1</span></a>.&nbsp;<a href="#cha-6_footnote-ref-8" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-9">The <code>update_attributes</code> method is an alias for the shorter <code>update</code> method, but I prefer the longer version because of its similarity to the singular version of the method, <code>update_attribute</code>.&nbsp;<a href="#cha-6_footnote-ref-9" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-10">I’ll omit the output of console commands when they are not particularly instructive—for example, the results of <code>User.new</code>.&nbsp;<a href="#cha-6_footnote-ref-10" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-11">For example, did you know that <code>"Michael Hartl"@example.com</code>, with quotation marks and a space in the middle, is a valid email address according to the standard?<span class="intersentencespace"></span> Incredibly, it is—but it’s absurd.&nbsp;<a href="#cha-6_footnote-ref-11" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-12">Note that, in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#table-valid_email_regex">Table&nbsp;<span class="ref">6.1</span></a>, “letter” really means “lower-case letter”, but the <code>i</code> at the end of the regex enforces case-insensitive matching.&nbsp;<a href="#cha-6_footnote-ref-12" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-13">If you find it as useful as I do, I encourage you to <a target="_blank" href="http://bit.ly/donate-to-rubular">donate to Rubular</a> to reward developer <a target="_blank" href="http://lovitt.net/">Michael Lovitt</a> for his wonderful work.&nbsp;<a href="#cha-6_footnote-ref-13" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-14">As noted briefly in the introduction to this section, there is a dedicated test database, <code>db/test.sqlite3</code>, for this purpose.&nbsp;<a href="#cha-6_footnote-ref-14" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-15">Technically, only the domain part of the email address is case-insensitive: <em>foo@bar.com</em> is actually different from <em>Foo@bar.com</em>.<span class="intersentencespace"></span> In practice, though, it is a bad idea to rely on this fact; as noted at <a target="_blank" href="http://email.about.com/od/emailbehindthescenes/f/email_case_sens.htm">about.com</a>,
 “Since the case sensitivity of email addresses can create a lot of 
confusion, interoperability problems and widespread headaches, it would 
be foolish to require email addresses to be typed with the correct case.<span class="intersentencespace"></span>
 Hardly any email service or ISP does enforce case sensitive email 
addresses, returning messages whose recipient’s email address was not 
typed correctly (in all upper case, for example).”<span class="intersentencespace"></span> Thanks to reader Riley Moses for pointing this out.&nbsp;<a href="#cha-6_footnote-ref-15" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-16">Of course, we could just edit the migration file for the <code>users</code> table in <a class="hyperref" href="https://www.railstutorial.org/book/modeling_users#code-users_migration">Listing&nbsp;<span class="ref">6.2</span></a>, but that would require rolling back and then migrating back up.<span class="intersentencespace"></span> The Rails Way™ is to use migrations every time we discover that our data model needs to change.&nbsp;<a href="#cha-6_footnote-ref-16" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-17">See the <a target="_blank" href="http://api.rubyonrails.org/v4.2.2/classes/ActiveRecord/Callbacks.html">Rails API entry on callbacks</a> for more information on which callbacks Rails supports.&nbsp;<a href="#cha-6_footnote-ref-17" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-18">In this context, <em>virtual</em> means that the attributes exist on the model object but do not correspond to columns in the database.&nbsp;<a href="#cha-6_footnote-ref-18" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-19">Hashed password digests are often erroneously referred to as <em>encrypted passwords</em>.<span class="intersentencespace"></span> For example, the <a target="_blank" href="https://github.com/rails/rails/blob/master/activemodel/lib/active_model/secure_password.rb">source code</a> of <code>has_secure_password</code> makes this mistake, as did the first two editions of this tutorial.<span class="intersentencespace"></span> This terminology is wrong because by design encryption is <em>reversible</em>—the ability to encrypt implies the ability to <em>decrypt</em> as well.<span class="intersentencespace"></span> In contrast, the whole point of calculating a password’s hash digest is to be <em>irreversible</em>, so that it is computationally intractable to infer the original password from the digest.<span class="intersentencespace"></span> (Thanks to reader Andy Philips for pointing out this issue and for encouraging me to fix the broken terminology.)&nbsp;<a href="#cha-6_footnote-ref-19" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-20"><p>If for any reason something went wrong, you can always reset the database as follows:</p>
<ol>
<li>Quit the console.<span class="intersentencespace"></span>
</li>
<li>Run <code>$ rm -f development.sqlite3</code> at the command line to remove the database.<span class="intersentencespace"></span> (We’ll learn a more elegant method for doing this in <a class="hyperref" href="https://www.railstutorial.org/book/sign_up#cha-sign_up">Chapter&nbsp;<span class="ref">7</span></a>.)<span class="intersentencespace"></span>
</li>
<li>Re-run the migrations using <code>$ bundle exec rake db:migrate</code>.<span class="intersentencespace"></span>
</li>
<li>Restart the console.<span class="intersentencespace"></span>
</li>
</ol>
&nbsp;<a href="#cha-6_footnote-ref-20" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-21">By design, the bcrypt algorithm produces a <a target="_blank" href="https://en.wikipedia.org/wiki/Salt_%28cryptography%29">salted hash</a>, which protects against two important classes of attacks (<a target="_blank" href="https://en.wikipedia.org/wiki/Dictionary_attack">dictionary attacks</a> and <a target="_blank" href="https://en.wikipedia.org/wiki/Rainbow_table">rainbow table attacks</a>).&nbsp;<a href="#cha-6_footnote-ref-21" class="arrow">↑</a></li>
    <li id="_cha-6_footnote-22">Recall from <a class="hyperref" href="https://www.railstutorial.org/book/rails_flavored_ruby#sec-objects_and_message_passing">Section&nbsp;<span class="ref">4.2.3</span></a> that <code>!!</code> converts an object to its corresponding boolean value.&nbsp;<a href="#cha-6_footnote-ref-22" class="arrow">↑</a></li>
  </ol>
</div></div></div>
<div id="bookBottomMenu">
<div class="bookMenuArows">
<a class="leftArrow" href="javascript://">◄</a>
<a class="upArrow" href="javascript://">▲</a>
<a class="rightArrow" href="javascript://">►</a>
</div>
</div>
</div>
<div id="bookContentNotAvailable">
<img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/empty_content-f645e37a2f80dc1a63b6889833b1d916e96339ce337b9d.png" alt="Empty content f645e37a2f80dc1a63b6889833b1d916e96339ce337b9da5db9fd00748cf29b0">
Sorry, content not available
</div>
</div>
<div style="display: none;" class="emailPitch" id="bookEmailModal">
<a onclick="closeEmailPops()" class="emailSignupClose" href="javascript://">x</a>
<strong>STAY UP TO DATE!</strong>
<p>Joining the email list for this book will allow the author to contact
 you to let you know about special offers and when updates for the book 
are available.</p>
<div class="j_followBookForm"><form action="https://www.softcover.io/books/107/follow" accept-charset="UTF-8" method="get"><input name="utf8" value="✓" type="hidden">
<!-- %input{name: "name", type: "text", placeholder: "YOUR NAME"} -->
<input name="email" placeholder="Your email address" type="text">
<input class="greyButton optClick_follow" value="Follow Author" type="submit">
</form>

</div>
</div>
<script>
  // setup book nav
  $(function(){
    Book.init({
      title: "Ruby on Rails Tutorial (3rd Ed.)",
      path: "/book",
      slug: "ruby_on_rails_tutorial_3rd_edition",
      isArticle: false,
      s3_path_prefix: "636/ruby_on_rails_tutorial_3rd_edition",
      chapters: [{"title":"Frontmatter\n","number":0,"slug":"frontmatter","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/frontmatter_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=8be580e820b7f49c2b94222315c393a80b4c3bc62ca1228006f1ce1f02470de9"},{"title":"Chapter 1: From zero to deploy\n","number":1,"slug":"beginning","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/beginning_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=b591fc5f4f211adedb4ef9d4b517b241a585f97f642a8995016784b69b3a4702"},{"title":"Chapter 2: A toy app\n","number":2,"slug":"toy_app","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/toy_app_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=ae115cf704b5784211592d65796fbf03de611101ece90fda6c52b594e87b09b2"},{"title":"Chapter 3: Mostly static pages\n","number":3,"slug":"static_pages","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/static_pages_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=6fe99b60fb157c59d03efb19aa5c49563dd1bccd37236a0e266ed15cdf221fe9"},{"title":"Chapter 4: Rails-flavored Ruby\n","number":4,"slug":"rails_flavored_ruby","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/rails_flavored_ruby_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=5686b757bd38a0fc40157a3f2a4b1e06b6032e2f310c5b070574fadd259204b1"},{"title":"Chapter 5: Filling in the layout\n","number":5,"slug":"filling_in_the_layout","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/filling_in_the_layout_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=5037bca1cb57aa4a23e85eb43df36a69a38aa6eb12a83dc41b03c5846610723b"},{"title":"Chapter 6: Modeling users\n","number":6,"slug":"modeling_users","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/modeling_users_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=68f62706eac8e4d7292e8ce87e7297d2094c34afa328ce67864b545002428555"},{"title":"Chapter 7: Sign up\n","number":7,"slug":"sign_up","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/sign_up_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=afdbb0aeb1674cd9197f577a556c2643ea89a9f36f4c3269ce70592d48d6982c"},{"title":"Chapter 8: Log in, log out\n","number":8,"slug":"log_in_log_out","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/log_in_log_out_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=7b68d2121ed5feb21e4bb707585b4de87922a0a77376c84f0741d72f28e2d5da"},{"title":"Chapter 9: Updating, showing, and deleting users\n","number":9,"slug":"updating_and_deleting_users","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/updating_and_deleting_users_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=84a592822ce106e2af57105cb92ce517537f804a743f0b07b0ad319eac23cde2"},{"title":"Chapter 10: Account activation and password reset\n","number":10,"slug":"account_activation_password_reset","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/account_activation_password_reset_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=721ea3d8347b32159c4c4921ce893d98af8611bee5fb3d1b6ebfabc834d4d25b"},{"title":"Chapter 11: User microposts\n","number":11,"slug":"user_microposts","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/user_microposts_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=2b4831e83d02c41f3b4cce4f32c10cd6e2876bcc063ec6849834737f82cf990a"},{"title":"Chapter 12: Following users\n","number":12,"slug":"following_users","s3_url":"https://softcover.s3-us-west-2.amazonaws.com/636/ruby_on_rails_tutorial_3rd_edition/html/following_users_fragment.html?X-Amz-Expires=604800\u0026X-Amz-Date=20151030T155915Z\u0026X-Amz-Algorithm=AWS4-HMAC-SHA256\u0026X-Amz-Credential=AKIAJMNNDDBSYVXVHGAA/20151030/us-west-2/s3/aws4_request\u0026X-Amz-SignedHeaders=host\u0026X-Amz-Signature=f2b5bb1895097175e74152f8a9e45f027a74778520cd8d77784cc1e15aab2328"}],
      full_page: false,
      custom_math: "\"failing\": \"\\\\coloredtext{red}{\\\\textsc{\\\\textbf{red}}}\",\n\"passing\": \"\\\\coloredtext{ForestGreen}{\\\\textsc{\\\\textbf{green}}}\""
    });
  });
</script>

</div>
</div>
<div class="footer clearfix">
<div class="wrapper" id="hide_chromeFooter">
<em>powered by</em>
<a class="logo" href="http://www.softcover.io/"><img src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/logo_foot-06b81d3a7ed51e8bbd39d0caaa622c1f6f5fca29d725d2e7aa.png" alt="Logo foot 06b81d3a7ed51e8bbd39d0caaa622c1f6f5fca29d725d2e7aa1f6e79e3aaa4a5">
</a></div>
</div>

<script type="text/javascript">
setTimeout(function(){var a=document.createElement("script");
var b=document.getElementsByTagName("script")[0];
a.src=document.location.protocol+"//dnn506yrbagrg.cloudfront.net/pages/scripts/0023/6713.js?"+Math.floor(new Date().getTime()/3600000);
a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
</script>

<script type="text/javascript">
  var _sf_async_config = { uid: 9895, domain: 'softcover.io', useCanonical: true };
  (function() {
    function loadChartbeat() {
      window._sf_endpt = (new Date()).getTime();
      var e = document.createElement('script');
      e.setAttribute('language', 'javascript');
      e.setAttribute('type', 'text/javascript');
      e.setAttribute('src','//static.chartbeat.com/js/chartbeat.js');
      document.body.appendChild(e);
    };
    var oldonload = window.onload;
    window.onload = (typeof window.onload != 'function') ?
      loadChartbeat : function() { oldonload(); loadChartbeat(); };
  })();
</script>

<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    // _pa.orderId = "myOrderId"; // OPTIONAL: attach unique conversion identifier to conversions
    // _pa.revenue = "19.99"; // OPTIONAL: attach dynamic purchase values to conversions
    // _pa.productId = "myProductId"; // OPTIONAL: Include product ID for use with dynamic ads
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/54eea5d20a23b37d87000040.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>



<iframe src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/channel.html" style="position: absolute; top: -2000px; left: 0px;" id="stripeXDM_default626485_provider" name="stripeXDM_default626485_provider" frameborder="0"></iframe><div class=" fb_reset" id="fb-root"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/wjDNIDNrTQG.html" style="border: medium none;" tabindex="-1" title="Facebook Cross Domain Communication Frame" aria-hidden="true" id="fb_xdm_frame_https" scrolling="no" allowfullscreen="true" allowtransparency="true" name="fb_xdm_frame_https" frameborder="0"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/ping.html" style="display: none;" scrolling="no" allowfullscreen="true" allowtransparency="true" name="f257e5de21a308c" frameborder="0"></iframe></div></div></div><script src="Chapter%206:%20Modeling%20users%20%7C%20Ruby%20on%20Rails%20Tutorial%20%283rd%20Ed.%29%20%7C%20Softcover.io_files/chartbeat.js" type="text/javascript" language="javascript"></script></body></html>